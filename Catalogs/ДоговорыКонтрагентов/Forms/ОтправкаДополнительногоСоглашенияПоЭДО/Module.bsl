
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	Если Не ЗначениеЗаполнено(Параметры.ОбъектОтправки) Тогда
		ВызватьИсключение НСтр("ru='Непосредственное открытие этой формы не предусмотрено.'");
	КонецЕсли;
	
	ФорматыСохранения = Новый СписокЗначений;
	Справочники.ДоговорыКонтрагентов.ЗаполнитьПоддерживаемыеФорматыСохранения(
		ФорматыСохранения);
	
	КоличествоФорматов = ФорматыСохранения.Количество();
	Для Индекс = 0 По КоличествоФорматов - 1 Цикл
		Если Индекс > 2 Тогда
			Прервать;
		КонецЕсли;
		ФорматДляСохранения = ФорматыСохранения[Индекс];
		
		ИмяЭлементаФормата = СтрШаблон("ВыбранныйФормат%1", Формат(Индекс, "ЧГ="));
		Элементы[ИмяЭлементаФормата].СписокВыбора.Добавить(ФорматДляСохранения.Значение, " ");
		
		ИмяЭлементаКартинка = СтрШаблон("ВыбранныйФормат%1Картинка", Формат(Индекс, "ЧГ="));
		Элементы[ИмяЭлементаКартинка].Картинка = ФорматДляСохранения.Картинка;
		
		ИмяЭлементаПредставление = СтрШаблон("ВыбранныйФормат%1Представление", Формат(Индекс, "ЧГ="));
		Элементы[ИмяЭлементаПредставление].Заголовок = СтрШаблон(" %1", ФорматДляСохранения.Представление);
		
		Если ФорматДляСохранения.Пометка
			И Не ЗначениеЗаполнено(ВыбранныйФормат) Тогда
			ВыбранныйФормат = ФорматДляСохранения.Значение;
		КонецЕсли;
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ПередЗагрузкойДанныхИзНастроекНаСервере(Настройки)
	
	ФорматИзНастроек = Настройки["ВыбранныйФорматОтправкиПоЭДО"];
	Если ФорматИзНастроек <> Неопределено Тогда
		ВыбранныйФормат = Элементы.ВыбранныйФормат.СписокВыбора.НайтиПоЗначению(ФорматИзНастроек);
		Если ВыбранныйФормат <> Неопределено Тогда
			ВыбранныйФормат.Пометка = Истина;
		КонецЕсли;
		Настройки.Удалить("ВыбранныйФорматОтправкиПоЭДО");
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура Выбрать(Команда)
	
	ОповеститьОВыборе(ВыбранныйФормат);
	
КонецПроцедуры

#КонецОбласти
