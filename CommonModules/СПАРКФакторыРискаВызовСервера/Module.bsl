///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2025, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Подсистема "СПАРК".
// ОбщийМодуль.СПАРКФакторыРискаВызовСервера.
////////////////////////////////////////////////////////////////////////////////

#Область СлужебныеПроцедурыИФункции

#Область ФакторыРискаКонтрагента

// Возвращает информацию о факторах риска контрагента.
// В случае, если информации нет в кэше, тогда инициируется фоновое задание.
//
// Параметры:
//  Контрагент - ОпределяемыйТип.КонтрагентБИП, Строка - Контрагент или ИНН контрагента;
//  Параметры - см. СПАРКФакторыРискаКлиентСервер.ПараметрыПолученияФакторов.
//
// Возвращаемое значение:
//  См. СПАРКФакторыРискаКлиентСервер.НовыйРезультатФакторыРиска.
//
Функция ФакторыРискаКонтрагента(Знач Контрагент, Знач Параметры) Экспорт
		
	Результат = СПАРКФакторыРиска.ФакторыРискаКонтрагента(
		Контрагент,
		Параметры);

	Возврат Результат;

КонецФункции

// Факторы риска контрагента из результата работы веб-сервиса, сохраненного во временном хранилище.
//
// Параметры:
//  АдресВременногоХранилища - Строка - адрес временного хранилища, в котором хранится
//                                      результат вызова СПАРКФакторыРиска.ЗагрузитьФакторыРисков.
//
// Возвращаемое значение:
//  см. СПАРКФакторыРискаКлиентСервер.НовыйРезультатФакторыРиска.
//
Функция ЗагруженныеФакторыРиска(Знач АдресВременногоХранилища) Экспорт

	Результат = СПАРКФакторыРискаКлиентСервер.НовыйРезультатФакторыРиска();
	Результат.РаботаВМоделиСервиса = ОбщегоНазначения.РазделениеВключено();
	
	Если ПустаяСтрока(АдресВременногоХранилища) Тогда
		Результат.Вставить("ВидОшибки", Перечисления.ВидыОшибокСПАРКРиски.НеизвестнаяОшибка);
		Результат.Вставить("ТекстОшибки", НСтр("ru='Вызов веб-сервиса не сохранил данные в хранилище.'"));
	Иначе
		ДанныеХранилища = ПолучитьИзВременногоХранилища(АдресВременногоХранилища);
		Если (ТипЗнч(ДанныеХранилища) = Тип("Структура")) Тогда
			Если ДанныеХранилища.ВидОшибки.Пустая() Тогда
			
				Для Каждого ЗначениеФактора Из ДанныеХранилища.ЗначенияФакторов Цикл
					РезультатЗагрузки = ЗначениеФактора;
				КонецЦикла;
				ЗаполнитьЗначенияСвойств(Результат, РезультатЗагрузки.Значение);
			Иначе
				Результат.Вставить("ВидОшибки", ДанныеХранилища.ВидОшибки);
				Результат.Вставить("ТекстОшибки", ДанныеХранилища.СообщениеОбОшибке);
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;

КонецФункции

#КонецОбласти

#КонецОбласти
