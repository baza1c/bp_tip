
Функция ПолучитьЛистыУведомления(Уведомление, Лист1АДляПечати = Неопределено) Экспорт
	
	СведенияОбУведомлении = Документы.УведомлениеОКонтролируемыхСделках.ПолучитьСведенияОбУведомлении(Уведомление);
	
	ДатаАктуальностиСведений = КонецГода(СведенияОбУведомлении.ОтчетныйГод);
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("УведомлениеОКонтролируемойСделке", Уведомление);
	Запрос.УстановитьПараметр("ДатаАктуальностиСведений", ДатаАктуальностиСведений);
	Запрос.УстановитьПараметр("ПустойИдентификатор", ОбщегоНазначенияКлиентСервер.ПустойУникальныйИдентификатор());
	
	Если СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		Запрос.Текст = Документы.УведомлениеОКонтролируемыхСделках.ПолучитьТекстЗапросаПоКонтролируемымСделкам_2018();
	Иначе
		Запрос.Текст = Документы.УведомлениеОКонтролируемыхСделках.ПолучитьТекстЗапросаПоКонтролируемымСделкам_2012();
	КонецЕсли;
	
	Если Лист1АДляПечати <> Неопределено Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "И НЕ КонтролируемаяСделка.ПометкаУдаления", "И НЕ КонтролируемаяСделка.ПометкаУдаления И КонтролируемаяСделка.Ссылка = &Лист1АДляПечати");
		Запрос.УстановитьПараметр("Лист1АДляПечати", Лист1АДляПечати);
	КонецЕсли;
	Запрос.Выполнить();
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	Листы1А.*
	|ИЗ
	|	Листы1А КАК Листы1А
	|УПОРЯДОЧИТЬ ПО
	|	Листы1А.НомерЛиста1А
	|;
	|
	|//////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Листы1Б.*
	|ИЗ
	|	Листы1Б КАК Листы1Б
	|УПОРЯДОЧИТЬ ПО
	|	Листы1Б.НомерЛиста1А, Листы1Б.НомерСтроки
	|;
	|//////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Листы1В.*
	|ИЗ
	|	Листы1В КАК Листы1В
	|УПОРЯДОЧИТЬ ПО
	|	Листы1В.НомерЛиста1А, Листы1В.НомерСтроки1Б, Листы1В.НомерСтроки
	|;
	|
	|//////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Листы1Г.*
	|ИЗ
	|	Листы1Г КАК Листы1Г
	|УПОРЯДОЧИТЬ ПО
	|	Листы1Г.НомерЛиста1А, Листы1Г.НомерСтроки1Б, Листы1Г.НомерСтроки
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Раздел2.Контрагент КАК Контрагент,
	|	Раздел2.Строка020ТипОрганизации КАК Строка020ТипОрганизации,
	|	Раздел2.Строка030КакКодСтраныРегистрации КАК Строка030КакКодСтраныРегистрации,
	|	Раздел2.Строка040Наименование КАК Строка040Наименование,
	|	Раздел2.Строка040НаименованиеЛат КАК Строка040НаименованиеЛат,
	|	Раздел2.Строка050ИНН КАК Строка050ИНН,
	|	Раздел2.Строка060КПП КАК Строка060КПП,
	|	Раздел2.Строка070РегНомерВСтрокеРегистрации КАК Строка070РегНомерВСтрокеРегистрации,
	|	Раздел2.НалоговыйРегистрационныйНомер КАК НалоговыйРегистрационныйНомер,
	|	Раздел2.НаименованиеИдентификатораРегистрационногоНомера КАК НаименованиеИдентификатораРегистрационногоНомера,
	|	Раздел2.Строка080КодНалогВСтранеРегистрации КАК Строка080КодНалогВСтранеРегистрации,
	|	Раздел2.Строка090АдресИностраннойОрганизации КАК Строка090АдресИностраннойОрганизации,
	|	Раздел2.АдресИностраннойОрганизацииЗначение КАК АдресИностраннойОрганизацииЗначение
	|ИЗ
	|	Раздел2 КАК Раздел2
	|
	|УПОРЯДОЧИТЬ ПО
	|	Раздел2.Строка040Наименование
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Раздел3.Контрагент КАК Контрагент,
	|	Раздел3.Строка020КодВидаДеятельности КАК Строка020КодВидаДеятельности,
	|	Раздел3.Строка030ИНН КАК Строка030ИНН,
	|	Раздел3.ФизическоеЛицо КАК ФизическоеЛицо,
	|	Раздел3.ДатаРождения КАК ДатаРождения,
	|	Раздел3.МестоРождения КАК МестоРождения,
	|	Раздел3.ГражданствоФизЛицСтрана КАК ГражданствоФизЛицСтрана,
	|	Раздел3.ВидКонтактнойИнформации КАК ВидКонтактнойИнформации,
	|	Раздел3.КонтактнаяИнформацияЗначенияПолей КАК КонтактнаяИнформацияЗначенияПолей,
	|	Раздел3.КонтактнаяИнформацияЗначениеJSON КАК КонтактнаяИнформацияЗначениеJSON,
	|	Раздел3.КонтактнаяИнформацияСтрана КАК КонтактнаяИнформацияСтрана,
	|	Раздел3.КонтактнаяИнформацияПредставление КАК КонтактнаяИнформацияПредставление,
	|	Раздел3.КонтактнаяИнформацияЗаРФСтрана КАК КонтактнаяИнформацияЗаРФСтрана,
	|	Раздел3.КонтактнаяИнформацияЗаРФПредставление КАК КонтактнаяИнформацияЗаРФПредставление,
	|	Раздел3.ВидДокумента КАК ВидДокумента,
	|	Раздел3.ДокументСерия КАК ДокументСерия,
	|	Раздел3.ДокументНомер КАК ДокументНомер,
	|	Раздел3.ДокументКемВыдан КАК ДокументКемВыдан,
	|	Раздел3.ДокументДатаВыдачи КАК ДокументДатаВыдачи,
	|	Раздел3.Фамилия КАК Фамилия,
	|	Раздел3.Имя КАК Имя,
	|	Раздел3.Отчество КАК Отчество
	|ИЗ
	|	Раздел3 КАК Раздел3
	|
	|УПОРЯДОЧИТЬ ПО
	|	Раздел3.Фамилия,
	|	Раздел3.Имя,
	|	Раздел3.Отчество
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Раздел4.Контрагент КАК Контрагент,
	|	Раздел4.ТипОрганизации КАК ТипОрганизации,
	|	Раздел4.КодСтраныРегистрации КАК КодСтраныРегистрации,
	|	Раздел4.НаименованиеКонтрагента КАК НаименованиеКонтрагента,
	|	Раздел4.РегистрационныйНомер КАК РегистрационныйНомер
	|ИЗ
	|	Раздел4 КАК Раздел4
	|
	|УПОРЯДОЧИТЬ ПО
	|	Раздел4.НаименованиеКонтрагента
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Листы1А.Сделка КАК Сделка,
	|	Листы1А.НомерЛиста1А КАК НомерЛиста1А,
	|	Листы1Б.Контрагент КАК Контрагент,
	|	ЛОЖЬ КАК СведенияОКомиссионере,
	|	""0"" КАК СведОтносительноАгента
	|ИЗ
	|	Листы1Б КАК Листы1Б
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Листы1А КАК Листы1А
	|		ПО (Листы1А.Сделка = Листы1Б.Сделка)
	|ГДЕ
	|	Листы1Б.ТипКонтрагента = ЗНАЧЕНИЕ(Перечисление.ЮридическоеФизическоеЛицо.ЮридическоеЛицо)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Листы1А.Сделка,
	|	Листы1А.НомерЛиста1А,
	|	Листы1Б.Комиссионер,
	|	ИСТИНА,
	|	""1""
	|ИЗ
	|	Листы1Б КАК Листы1Б
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Листы1А КАК Листы1А
	|		ПО Листы1Б.Сделка = Листы1А.Сделка
	|ГДЕ
	|	Листы1Б.ТипКомиссионера = ЗНАЧЕНИЕ(Перечисление.ЮридическоеФизическоеЛицо.ЮридическоеЛицо)
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерЛиста1А,
	|	СведенияОКомиссионере УБЫВ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Листы1А.Сделка КАК Сделка,
	|	Листы1А.НомерЛиста1А КАК НомерЛиста1А,
	|	Листы1Б.Контрагент КАК Контрагент,
	|	ЛОЖЬ КАК СведенияОКомиссионере,
	|	""0"" КАК СведОтносительноАгента
	|ИЗ
	|	Листы1Б КАК Листы1Б
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Листы1А КАК Листы1А
	|		ПО (Листы1А.Сделка = Листы1Б.Сделка)
	|ГДЕ
	|	Листы1Б.ТипКонтрагента = ЗНАЧЕНИЕ(Перечисление.ЮридическоеФизическоеЛицо.ФизическоеЛицо)
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Листы1А.Сделка,
	|	Листы1А.НомерЛиста1А,
	|	Листы1Б.Комиссионер,
	|	ИСТИНА,
	|	""1""
	|ИЗ
	|	Листы1Б КАК Листы1Б
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Листы1А КАК Листы1А
	|		ПО Листы1Б.Сделка = Листы1А.Сделка
	|ГДЕ
	|	Листы1Б.ТипКомиссионера = ЗНАЧЕНИЕ(Перечисление.ЮридическоеФизическоеЛицо.ФизическоеЛицо)
	|
	|УПОРЯДОЧИТЬ ПО
	|	НомерЛиста1А,
	|	СведенияОКомиссионере УБЫВ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	Листы1В.Сделка КАК Сделка,
	|	Листы1В.НомерЛиста1А КАК НомерЛиста1А,
	|	Листы1В.Контрагент КАК Контрагент
	|ИЗ
	|	Листы1В КАК Листы1В
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Листы1А КАК Листы1А
	|		ПО (Листы1А.Сделка = Листы1В.Сделка)
	|ГДЕ
	|	Листы1В.Контрагент <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СвязиЛистов1Би1В.Сделка КАК Сделка,
	|	СвязиЛистов1Би1В.НомерСтроки КАК НомерСтроки,
	|	СвязиЛистов1Би1В.ИдентификаторЛиста1Б КАК ИдентификаторЛиста1Б,
	|	СвязиЛистов1Би1В.ИдентификаторЛиста1В КАК ИдентификаторЛиста1В
	|ИЗ
	|	СвязиЛистов1Би1В КАК СвязиЛистов1Би1В";
	
	Результат = Запрос.ВыполнитьПакет();
	Листы1А = Результат[0].Выгрузить();
	Листы1Б = Результат[1].Выгрузить();
	Листы1В = Результат[2].Выгрузить();
	Листы1Г = Результат[3].Выгрузить();
	Раздел2 = Результат[4].Выгрузить();
	Раздел3 = Результат[5].Выгрузить();
	Раздел4 = Результат[6].Выгрузить();
	Листы2 = Результат[7].Выгрузить();
	Листы3 = Результат[8].Выгрузить();
	Листы4 = Результат[9].Выгрузить();
	Связь1Би1В = Результат[10].Выгрузить();

	Листы1А.Индексы.Добавить("Сделка");
	Листы1Б.Индексы.Добавить("Сделка");
	Листы1В.Индексы.Добавить("Сделка");
	Листы1Г.Индексы.Добавить("Сделка");
	Раздел2.Индексы.Добавить("Контрагент");
	Раздел3.Индексы.Добавить("Контрагент");
	Раздел4.Индексы.Добавить("Контрагент");
	Листы2.Индексы.Добавить("Сделка");
	Листы3.Индексы.Добавить("Сделка");
	Листы4.Индексы.Добавить("Сделка");
	Связь1Би1В.Индексы.Добавить("ИдентификаторЛиста1В");
	
	ОписаниеТипаНомераУчастникаСделки = Новый ОписаниеТипов("Число", 
		Новый КвалификаторыЧисла(4, 0, ДопустимыйЗнак.Неотрицательный));
	
	Раздел2.Колонки.Добавить("НомерКонтрагента", ОписаниеТипаНомераУчастникаСделки);
	Раздел3.Колонки.Добавить("НомерКонтрагента", ОписаниеТипаНомераУчастникаСделки);
	Раздел4.Колонки.Добавить("НомерКонтрагента", ОписаниеТипаНомераУчастникаСделки);
	
	ДобавитьКолонкиАдресаИностранногоКонтрагента(Раздел2);
	
	НомерКонтрагента = 1;
	Для Каждого Контрагент Из Раздел2 Цикл
		Контрагент.НомерКонтрагента = НомерКонтрагента;
		ЗаполнитьКолонкиАдресаИностранногоКонтрагента(Контрагент);
		НомерКонтрагента = НомерКонтрагента + 1;
	КонецЦикла;
	Для Каждого Контрагент Из Раздел3 Цикл
		Контрагент.НомерКонтрагента = НомерКонтрагента;
		НомерКонтрагента = НомерКонтрагента + 1;
	КонецЦикла;
	Для Каждого Контрагент Из Раздел4 Цикл
		Контрагент.НомерКонтрагента = НомерКонтрагента;
		НомерКонтрагента = НомерКонтрагента + 1;
	КонецЦикла;
	
	ТипНомераСтраницы = Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(10, 0, ДопустимыйЗнак.Неотрицательный));
	
	ДлинаНомераЛистовРаздела1 = СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераЛистовРаздела1;
	КоличествоЛистовРаздела = Новый ОписаниеТипов("Число", 
		Новый КвалификаторыЧисла(ДлинаНомераЛистовРаздела1, 0, ДопустимыйЗнак.Неотрицательный));
	
	Листы1А.Колонки.Добавить("Количество1Б", КоличествоЛистовРаздела);
	Листы1А.Колонки.Добавить("Количество1В", КоличествоЛистовРаздела);
	
	ТипКодТипаСделки = Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(1, 0, ДопустимыйЗнак.Неотрицательный));
	Листы1А.Колонки.Добавить("КодТипаСделки1", ТипКодТипаСделки);
	Листы1А.Колонки.Добавить("КодТипаСделки2", ТипКодТипаСделки);
	Листы1А.Колонки.Добавить("КодТипаСделки3", ТипКодТипаСделки);
	
	Листы1Б.Колонки.Добавить("Строка050НомерУчастникаСделки", ОписаниеТипаНомераУчастникаСделки);
	Листы1Б.Колонки.Добавить("НомерЛиста1Б", ТипНомераСтраницы);
	Листы1В.Колонки.Добавить("НомерУчастникаСделки", ОписаниеТипаНомераУчастникаСделки);
	
	ДлинаНомераЛиста1В = 5;
	ТипНомераЛиста1В = ОбщегоНазначения.ОписаниеТипаСтрока(ДлинаНомераЛиста1В);
	ТипНомераЛиста1ВЧислом = ОбщегоНазначения.ОписаниеТипаЧисло(ДлинаНомераЛиста1В, 0);
	
	Листы1В.Колонки.Добавить("НомерЛиста1Б", ТипНомераСтраницы);
	Листы1В.Колонки.Добавить("НомерЛиста1В_0", ТипНомераЛиста1В);
	Листы1В.Колонки.Добавить("НомерЛиста1В_1", ТипНомераЛиста1В);
	Листы1В.Колонки.Добавить("НомерЛиста1В_2", ТипНомераЛиста1В);
	Листы1В.Колонки.Добавить("НомерЛиста1В_3", ТипНомераЛиста1В);
	Листы1В.Колонки.Добавить("СправочноНомераЛистов1Б", ОбщегоНазначения.ОписаниеТипаСтрока(255));
	
	Листы1Г.Колонки.Добавить("НомерЛиста1Б", ТипНомераСтраницы);
	
	Листы1ГСвдоенные = ПодготовитьСдвоенныеЛисты1Г(Листы1Г);
	
	Листы = Новый ТаблицаЗначений();
	Листы.Колонки.Добавить("Раздел",             Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(50)));
	Листы.Колонки.Добавить("НомерСтрокиРаздела", Новый ОписаниеТипов("Число", Новый КвалификаторыЧисла(15,0)));
	
	ДобавитьЛистВУведомление(Листы, "ТитульныйЛист", 0);
	//Для организации физического-лица титульные листы содержат 2 листа
	Если СведенияОбУведомлении.ЮридическоеФизическоеЛицо = Перечисления.ЮридическоеФизическоеЛицо.ФизическоеЛицо
		И СокрЛП(СведенияОбУведомлении.ИНН) = "" Тогда
		ДобавитьЛистВУведомление(Листы, "ТитульныйЛистФизическоеЛицо", 0);
	КонецЕсли;
	
	НомераЛистов1Б = Новый Соответствие;
	
	ТаблицаСвязей1В = Новый ТаблицаЗначений;
	ТаблицаСвязей1В.Колонки.Добавить("НомерЛиста1Б", ТипНомераСтраницы);
	ТаблицаСвязей1В.Колонки.Добавить("НомерЛиста1БСтрокой", ОбщегоНазначения.ОписаниеТипаСтрока(10));
	
	//нумерация листов раздела 1А и 1Б
	Для каждого Лист1А Из Листы1А Цикл
		
		НомерЛиста1Б = 0;
		
		ДобавитьЛистВУведомление(Листы, "Лист1А", Листы1А.Индекс(Лист1А));
		
		Отбор = Новый Структура("Сделка", Лист1А.Сделка);
		
		СписокЛистов1Б = Листы1Б.НайтиСтроки(Отбор);
		Лист1А.Количество1Б = СписокЛистов1Б.Количество();
		
		Для Каждого Лист1Б Из СписокЛистов1Б Цикл
			
			ДобавитьЛистВУведомление(Листы, "Лист1Б", Листы1Б.Индекс(Лист1Б));
			
			Если Лист1Б.ТипКонтрагента = Перечисления.ЮридическоеФизическоеЛицо.ФизическоеЛицо Тогда
				СведенияОКонтрагенте = Раздел3.Найти(Лист1Б.Контрагент, "Контрагент");
			Иначе
				СведенияОКонтрагенте = Раздел2.Найти(Лист1Б.Контрагент, "Контрагент");
			КонецЕсли;
			Если СведенияОКонтрагенте <> Неопределено Тогда
				Лист1Б.Строка050НомерУчастникаСделки = СведенияОКонтрагенте.НомерКонтрагента;
			КонецЕсли;
			
			Если Лист1Б.УказыватьСведенияЦепочкиСозданияСтоимости Тогда
				НомерЛиста1Б = НомерЛиста1Б + 1;
				Лист1Б.НомерЛиста1Б = НомерЛиста1Б;
				НомераЛистов1Б.Вставить(Лист1Б.ИдентификаторЛиста1Б, Лист1Б.НомерЛиста1Б);
			КонецЕсли;
			
		КонецЦикла;
		
		Если Лист1А.УказыватьСведенияЦепочкиСозданияСтоимости Тогда
			
			// Номера листов 1В составные, состоят из 4 частей.
			// Для листов 1В первого уровня заполняется только первая часть, для листов 1В второго уровня - 
			// заполняется первая часть из листа-родителя, и заполняется вторая часть. И т.д.
			// Например, у нас есть цепочка листов 1В: ID1 - ID2 - ID3.
			// В этом случае для листа ID1 будет НомерЛиста1В_0 = 1, остальные номера листов - пустые.
			// Для листа ID2 будет НомерЛиста1В_0 = 1, НомерЛиста1В_1 = 1, остальные пустые.
			// Для листа ID3 будет НомерЛиста1В_0 = 1, НомерЛиста1В_1 = 1, НомерЛиста1В_2 = 1, НомерЛиста1В_3 = 0.
			// Нумерация уникальна в пределах листа 1Б. Если листы не связаны с листами 1Б, то для них действует отдельная нумерация,
			// которая уникальна в пределах листа 1А.
			
			ТаблицаЦепочкиЛистов1В = Новый ТаблицаЗначений;
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("НомерЛиста1Б", ТипНомераСтраницы);
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("НомерСтроки", Листы1В.Колонки.НомерСтроки.ТипЗначения);
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("ИдентификаторЛиста1В", Новый ОписаниеТипов("УникальныйИдентификатор"));
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("ИдентификаторПредыдущегоЛиста1В", Новый ОписаниеТипов("УникальныйИдентификатор"));
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("НомерЛиста1В_0", ТипНомераЛиста1ВЧислом);
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("НомерЛиста1В_1", ТипНомераЛиста1ВЧислом);
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("НомерЛиста1В_2", ТипНомераЛиста1ВЧислом);
			ТаблицаЦепочкиЛистов1В.Колонки.Добавить("НомерЛиста1В_3", ТипНомераЛиста1ВЧислом);
			ТаблицаЦепочкиЛистов1В.Индексы.Добавить("НомерЛиста1Б,ИдентификаторПредыдущегоЛиста1В");
			
			СписокЛистов1В = Листы1В.НайтиСтроки(Отбор);
			Лист1А.Количество1В = СписокЛистов1В.Количество();
			
			Для Каждого Лист1В Из СписокЛистов1В Цикл
				
				ДобавитьЛистВУведомление(Листы, "Лист1В", Листы1В.Индекс(Лист1В));
				
				СведенияОКонтрагенте = Раздел4.Найти(Лист1В.Контрагент, "Контрагент");
				Если СведенияОКонтрагенте <> Неопределено Тогда
					Лист1В.НомерУчастникаСделки = СведенияОКонтрагенте.НомерКонтрагента;
				КонецЕсли;
				
				Если Лист1В.ТипЛиста = Перечисления.ТипыСделокВЦепочкеКонтролируемыхСделок.ПоследующаяРеализация Тогда
					Лист1А.КодТипаСделки1 = 1;
				ИначеЕсли Лист1В.ТипЛиста = Перечисления.ТипыСделокВЦепочкеКонтролируемыхСделок.ПредшествующаяПокупка Тогда
					Лист1А.КодТипаСделки2 = 1;
				КонецЕсли;
				
				Если Лист1В.ИдентификаторЛиста1Б <> ОбщегоНазначенияКлиентСервер.ПустойУникальныйИдентификатор() Тогда
					
					Лист1В.НомерЛиста1Б = НомераЛистов1Б.Получить(Лист1В.ИдентификаторЛиста1Б);
					
					ТаблицаСвязей1В.Очистить();
					СвязиЛиста1В = Связь1Би1В.НайтиСтроки(Новый Структура("ИдентификаторЛиста1В", Лист1В.ИдентификаторЛиста1В));
					Если СвязиЛиста1В.Количество() > 1 Тогда
						Для Каждого СвязьЛиста1В Из СвязиЛиста1В Цикл
							СтрокаСвязи = ТаблицаСвязей1В.Добавить();
							СтрокаСвязи.НомерЛиста1Б = НомераЛистов1Б.Получить(СвязьЛиста1В.ИдентификаторЛиста1Б);
							СтрокаСвязи.НомерЛиста1БСтрокой = Формат(СтрокаСвязи.НомерЛиста1Б, "ЧЦ=10; ЧДЦ=0; ЧГ=0");
						КонецЦикла;
						ТаблицаСвязей1В.Сортировать("НомерЛиста1Б");
						Связи1В = Новый Массив;
						Для Каждого СтрокаСвязи Из ТаблицаСвязей1В Цикл
							Связи1В.Добавить(СтрокаСвязи.НомерЛиста1БСтрокой);
						КонецЦикла;
						
						Лист1В.СправочноНомераЛистов1Б = СтрСоединить(Связи1В, ";");
					КонецЕсли;
					
				КонецЕсли;
				
				СтрокаЦепочкиЛистов1В = ТаблицаЦепочкиЛистов1В.Добавить();
				СтрокаЦепочкиЛистов1В.НомерСтроки = Лист1В.НомерСтроки;
				СтрокаЦепочкиЛистов1В.НомерЛиста1Б = Лист1В.НомерЛиста1Б;
				СтрокаЦепочкиЛистов1В.ИдентификаторЛиста1В = Лист1В.ИдентификаторЛиста1В;
				СтрокаЦепочкиЛистов1В.ИдентификаторПредыдущегоЛиста1В = Лист1В.ИдентификаторПредыдущегоЛиста1В;
				
			КонецЦикла;
			
			ЗаполнитьСвязиЛистов1В(СписокЛистов1В, ТаблицаЦепочкиЛистов1В);
			
			СписокЛистов1Г = Листы1ГСвдоенные.НайтиСтроки(Отбор);
			Для Каждого Лист1Г Из СписокЛистов1Г Цикл
				
				ДобавитьЛистВУведомление(Листы, "Лист1Г", Листы1ГСвдоенные.Индекс(Лист1Г));
				Лист1А.КодТипаСделки3 = 1;
				Лист1Г.НомерЛиста1Б = НомераЛистов1Б.Получить(Лист1Г.ИдентификаторЛиста1Б);
				
			КонецЦикла;
			
		КонецЕсли;
		
		СписокЛистов2 = Листы2.НайтиСтроки(Отбор);
		Для Каждого Лист2 Из СписокЛистов2 Цикл
			ДобавитьЛистВУведомление(Листы, "Раздел2", Листы2.Индекс(Лист2));
		КонецЦикла;
		
		СписокЛистов3 = Листы3.НайтиСтроки(Отбор);
		Для Каждого Лист3 Из СписокЛистов3 Цикл
			ДобавитьЛистВУведомление(Листы, "Раздел3", Листы3.Индекс(Лист3));
		КонецЦикла;
		
	КонецЦикла;
	
	// Для печати выводятся листы 1Г сдвоенные на одном листе.
	// Но для выгрузки сдвоенность листов не нужна.
	// Поэтому мы заполняем и доп. параметры в Лист1Г.
	Для Каждого Лист1Г Из Листы1Г Цикл
		Лист1Г.НомерЛиста1Б = НомераЛистов1Б.Получить(Лист1Г.ИдентификаторЛиста1Б);
	КонецЦикла;
	
	// Листы раздела 4 выводятся без привязки к сделке (Листу 1А),
	// поэтому добавляем их после все листов разделов 1-3.
	// Из-за этого и нет деления на ЛистыРаздела4 и Листы4, т.к. они идентичны.
	Для Каждого Лист4 Из Раздел4 Цикл
		ДобавитьЛистВУведомление(Листы, "Раздел4", Раздел4.Индекс(Лист4));
	КонецЦикла;
	
	ЛистыУведомления = Новый Структура();
	ЛистыУведомления.Вставить("Листы", Листы);
	ЛистыУведомления.Вставить("ЛистыРаздела1А", Листы1А);
	ЛистыУведомления.Вставить("ЛистыРаздела1Б", Листы1Б);
	ЛистыУведомления.Вставить("ЛистыРаздела1В", Листы1В);
	ЛистыУведомления.Вставить("ЛистыРаздела1Г", Листы1Г);
	ЛистыУведомления.Вставить("ЛистыРаздела1ГСдвоенные", Листы1ГСвдоенные);
	ЛистыУведомления.Вставить("ЛистыРаздела2", Листы2);
	ЛистыУведомления.Вставить("ЛистыРаздела3", Листы3);
	ЛистыУведомления.Вставить("ЛистыРаздела4", Листы4);
	ЛистыУведомления.Вставить("ДанныеРаздела2", Раздел2);
	ЛистыУведомления.Вставить("ДанныеРаздела3", Раздел3);
	ЛистыУведомления.Вставить("ДанныеРаздела4", Раздел4);
	
	Возврат ЛистыУведомления;
	
КонецФункции

Функция ДлинаИерархииЛистов1В()
	Возврат 3;
КонецФункции

Процедура ЗаполнитьСвязиЛистов1В(СписокЛистов1В, ТаблицаЦепочкиЛистов1В)
	
	ПустойИдентификатор = ОбщегоНазначенияКлиентСервер.ПустойУникальныйИдентификатор();
	
	ТаблицаЦепочкиЛистов1В.Сортировать("НомерЛиста1Б,НомерСтроки");
	
	// Нумерация листов уникальна в пределах листа 1Б (или всего листа 1А, если связь с листами 1Б для листа 1В не установлена).
	ТекущийНомерЛиста1Б = Неопределено;
	НомерЛиста1В = 0;
	
	// Сначала заполним номера листов 1 уровня.
	Для Каждого СтрокаЦепочкиЛистов1В Из ТаблицаЦепочкиЛистов1В Цикл
		
		Если ТекущийНомерЛиста1Б = Неопределено
			Или ТекущийНомерЛиста1Б <> СтрокаЦепочкиЛистов1В.НомерЛиста1Б Тогда
			ТекущийНомерЛиста1Б = СтрокаЦепочкиЛистов1В.НомерЛиста1Б;
			НомерЛиста1В = 0;
		КонецЕсли;
		
		Если СтрокаЦепочкиЛистов1В.ИдентификаторПредыдущегоЛиста1В = ПустойИдентификатор Тогда
			НомерЛиста1В = НомерЛиста1В + 1;
			СтрокаЦепочкиЛистов1В.НомерЛиста1В_0 = НомерЛиста1В;
			ЗаполнитьНомераДочернихЛистов(СтрокаЦепочкиЛистов1В, ТаблицаЦепочкиЛистов1В, 1);
		КонецЕсли;
		
	КонецЦикла;
	
	Для Каждого СтрокаСписка Из СписокЛистов1В Цикл
		СтрокаСледующихЛистов = ТаблицаЦепочкиЛистов1В.Найти(СтрокаСписка.ИдентификаторЛиста1В, "ИдентификаторЛиста1В");
		Если СтрокаСледующихЛистов = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		Для НомерИерархии = 0 По ДлинаИерархииЛистов1В() Цикл
			
			Номер1ВЧислом = СтрокаСледующихЛистов["НомерЛиста1В_" + Формат(НомерИерархии, "ЧДЦ=0; ЧН=0; ЧГ=0")];
			
			Если Номер1ВЧислом = 0 Тогда
				Продолжить;
			КонецЕсли;
			
			Если СтрокаСписка.ИдентификаторЛиста1Б = ПустойИдентификатор Тогда
				Номер1ВСтрокой = "0." + Формат(Номер1ВЧислом, "ЧЦ=3; ЧДЦ=0; ЧГ=0");
			Иначе
				Номер1ВСтрокой = Формат(Номер1ВЧислом, "ЧЦ=5; ЧДЦ=0; ЧГ=0");
			КонецЕсли;
			
			СтрокаСписка["НомерЛиста1В_" + Формат(НомерИерархии, "ЧДЦ=0; ЧН=0; ЧГ=0")] = Номер1ВСтрокой;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

Процедура ЗаполнитьНомераДочернихЛистов(СтрокаРодительскойЦепочкиЛистов1В, ТаблицаЦепочкиЛистов1В, НомерИерархии)
	
	Если НомерИерархии > ДлинаИерархииЛистов1В() Тогда
		Возврат;
	КонецЕсли;
	
	НомерЛиста1В = 0;
	
	ОтборСтрок = Новый Структура();
	ОтборСтрок.Вставить("НомерЛиста1Б", СтрокаРодительскойЦепочкиЛистов1В.НомерЛиста1Б);
	ОтборСтрок.Вставить("ИдентификаторПредыдущегоЛиста1В", СтрокаРодительскойЦепочкиЛистов1В.ИдентификаторЛиста1В);
	ДочерниеСтроки = ТаблицаЦепочкиЛистов1В.НайтиСтроки(ОтборСтрок); 
	Для Каждого ДочерняяСтрокаЦепочкиЛистов1В Из ДочерниеСтроки Цикл
		ЗаполнитьЗначенияСвойств(ДочерняяСтрокаЦепочкиЛистов1В, СтрокаРодительскойЦепочкиЛистов1В, "НомерЛиста1В_0,НомерЛиста1В_1,НомерЛиста1В_2,НомерЛиста1В_3");
		НомерЛиста1В = НомерЛиста1В + 1;
		ДочерняяСтрокаЦепочкиЛистов1В["НомерЛиста1В_" + Формат(НомерИерархии, "ЧДЦ=0; ЧН=0; ЧГ=0")] = НомерЛиста1В;
		ЗаполнитьНомераДочернихЛистов(ДочерняяСтрокаЦепочкиЛистов1В, ТаблицаЦепочкиЛистов1В, НомерИерархии + 1);
	КонецЦикла;
	
КонецПроцедуры

Процедура ДобавитьЛистВУведомление(Знач Листы, Знач Раздел, Знач НомерСтрокиРаздела)
	
	Лист = Листы.Добавить();
	Лист.Раздел = Раздел;
	Лист.НомерСтрокиРаздела = НомерСтрокиРаздела;
	
КонецПроцедуры

Процедура ДобавитьКолонкиАдресаИностранногоКонтрагента(ТаблицаРаздела)
	
	// Максимальная длина части адреса - 80 символов (для улицы).
	// Остальные - 40 символов. Но для заполнения нам это не очень важно, поэтому делаем их все одинаковыми.
	ТипКолонкиСтрока = ОбщегоНазначения.ОписаниеТипаСтрока(80);
	
	ТаблицаРаздела.Колонки.Добавить("АдресИностранный_УлицаДом", ТипКолонкиСтрока);
	ТаблицаРаздела.Колонки.Добавить("АдресИностранный_Район", ТипКолонкиСтрока);
	ТаблицаРаздела.Колонки.Добавить("АдресИностранный_НаселенныйПункт", ТипКолонкиСтрока);
	ТаблицаРаздела.Колонки.Добавить("АдресИностранный_Регион", ТипКолонкиСтрока);
	ТаблицаРаздела.Колонки.Добавить("АдресИностранный_Страна", ТипКолонкиСтрока);
	
КонецПроцедуры

Процедура ЗаполнитьКолонкиАдресаИностранногоКонтрагента(СтрокаКонтрагента)
	
	Если Не ЗначениеЗаполнено(СтрокаКонтрагента.АдресИностраннойОрганизацииЗначение) Тогда
		Возврат;
	КонецЕсли;
	
	СведенияОбАдресе = РаботаСАдресами.СведенияОбАдресе(СтрокаКонтрагента.АдресИностраннойОрганизацииЗначение);
	
	Если ЗначениеЗаполнено(СведенияОбАдресе.Страна) Тогда
		СтрокаКонтрагента.АдресИностранный_Страна = СведенияОбАдресе.Страна;
	КонецЕсли;
	
	ЧастиРегион = Новый Массив;
	ЧастиНаселенныйПункт = Новый Массив;
	ЧастиРайон = Новый Массив;
	ЧастиУлица = Новый Массив;
	
	Если СведенияОбАдресе.Свойство("Регион")
		И ЗначениеЗаполнено(СведенияОбАдресе.Регион) Тогда
		ЧастиРегион.Добавить(СведенияОбАдресе.Регион);
	КонецЕсли;
	
	Если СведенияОбАдресе.Свойство("Район")
		И ЗначениеЗаполнено(СведенияОбАдресе.Район) Тогда
		ЧастиРегион.Добавить(СведенияОбАдресе.Район);
	КонецЕсли;
	
	Если СведенияОбАдресе.Свойство("Город")
		И ЗначениеЗаполнено(СведенияОбАдресе.Город) Тогда
		ЧастиНаселенныйПункт.Добавить(СведенияОбАдресе.Город);
	КонецЕсли;
	Если СведенияОбАдресе.Свойство("Индекс")
		И ЗначениеЗаполнено(СведенияОбАдресе.Индекс) Тогда
		ЧастиНаселенныйПункт.Добавить(СведенияОбАдресе.Индекс);
	КонецЕсли;
	
	Если СведенияОбАдресе.Свойство("НаселенныйПункт")
		И ЗначениеЗаполнено(СведенияОбАдресе.НаселенныйПункт) Тогда
		ЧастиРайон.Добавить(СведенияОбАдресе.НаселенныйПункт);
	КонецЕсли;
	
	Если СведенияОбАдресе.Свойство("Улица")
		И ЗначениеЗаполнено(СведенияОбАдресе.Улица) Тогда
		ЧастиУлица.Добавить(СведенияОбАдресе.Улица);
	КонецЕсли;
	
	Если СведенияОбАдресе.Свойство("Здание")
		И ЗначениеЗаполнено(СведенияОбАдресе.Здание)
		И СведенияОбАдресе.Здание.Свойство("Номер") Тогда
		ЧастиУлица.Добавить(СтрШаблон("%1 %2", СведенияОбАдресе.Здание.ТипЗдания, СведенияОбАдресе.Здание.Номер));
	КонецЕсли;
	
	Если СведенияОбАдресе.Свойство("Корпуса")
		И ЗначениеЗаполнено(СведенияОбАдресе.Корпуса) Тогда
		Для Каждого Корпус Из СведенияОбАдресе.Корпуса Цикл
			ЧастиУлица.Добавить(СтрШаблон("%1 %2", Корпус.ТипКорпуса, Корпус.Номер));
		КонецЦикла;
	КонецЕсли;
	
	Если СведенияОбАдресе.Свойство("Помещения")
		И ЗначениеЗаполнено(СведенияОбАдресе.Помещения) Тогда
		Для Каждого Помещение Из СведенияОбАдресе.Помещения Цикл
			ЧастиУлица.Добавить(СтрШаблон("%1 %2", Помещение.ТипПомещения, Помещение.Номер));
		КонецЦикла;
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ЧастиРегион) Тогда
		СтрокаКонтрагента.АдресИностранный_Регион = СтрСоединить(ЧастиРегион, ", ");
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ЧастиНаселенныйПункт) Тогда
		СтрокаКонтрагента.АдресИностранный_НаселенныйПункт = СтрСоединить(ЧастиНаселенныйПункт, ", ");
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ЧастиРайон) Тогда
		СтрокаКонтрагента.АдресИностранный_Район = СтрСоединить(ЧастиРайон, ", ");
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ЧастиУлица) Тогда
		СтрокаКонтрагента.АдресИностранный_УлицаДом = СтрСоединить(ЧастиУлица, ", ");
	КонецЕсли;
	
КонецПроцедуры

Функция ПодготовитьСдвоенныеЛисты1Г(Листы1Г)
	
	Листы1ГСвдоенные = Новый ТаблицаЗначений();
	
	ИменаКолонок1Г = Новый Массив;
	
	УникальныеКолонки1Г = Новый Массив;
	УникальныеКолонки1Г.Добавить("Сделка");
	УникальныеКолонки1Г.Добавить("НомерЛиста1А");
	УникальныеКолонки1Г.Добавить("ИдентификаторЛиста1Б");
	УникальныеКолонки1Г.Добавить("НомерЛиста1Б");
	
	Для Каждого Колонка1Г Из Листы1Г.Колонки Цикл
		Если УникальныеКолонки1Г.Найти(Колонка1Г.Имя) <> Неопределено Тогда
			Листы1ГСвдоенные.Колонки.Добавить(Колонка1Г.Имя, Колонка1Г.ТипЗначения);
		Иначе
			Листы1ГСвдоенные.Колонки.Добавить(Колонка1Г.Имя + "1", Колонка1Г.ТипЗначения);
			Листы1ГСвдоенные.Колонки.Добавить(Колонка1Г.Имя + "2", Колонка1Г.ТипЗначения);
		КонецЕсли;
	КонецЦикла;
	
	Листы1Г.Сортировать("НомерЛиста1А,ИдентификаторЛиста1Б,НомерСтроки");
	
	ТекущаяСдвоеннаяСтрока = Неопределено;
	ТекущийНомер = 1;
	Для Каждого Строка1Г Из Листы1Г Цикл
		Если ТекущаяСдвоеннаяСтрока = Неопределено
			Или ТекущаяСдвоеннаяСтрока.ИдентификаторЛиста1Б <> Строка1Г.ИдентификаторЛиста1Б
			Или ТекущийНомер > 2 Тогда
			ТекущаяСдвоеннаяСтрока = Листы1ГСвдоенные.Добавить();
			ТекущаяСдвоеннаяСтрока.ИдентификаторЛиста1Б = Строка1Г.ИдентификаторЛиста1Б;
			ТекущаяСдвоеннаяСтрока.Сделка = Строка1Г.Сделка;
			ТекущаяСдвоеннаяСтрока.НомерЛиста1А = Строка1Г.НомерЛиста1А;
			ТекущийНомер = 1;
		КонецЕсли;
		
		Для Каждого Колонка1Г Из Листы1Г.Колонки Цикл
			Если УникальныеКолонки1Г.Найти(Колонка1Г.Имя) <> Неопределено Тогда
				Продолжить;
			КонецЕсли;
			ТекущаяСдвоеннаяСтрока[Колонка1Г.Имя + Строка(ТекущийНомер)] = Строка1Г[Колонка1Г.Имя];
		КонецЦикла;
		
		ТекущийНомер = ТекущийНомер + 1;
		
	КонецЦикла;
	
	Листы1ГСвдоенные.Индексы.Добавить("Сделка");
	
	Возврат Листы1ГСвдоенные;
	
КонецФункции

Функция ПолучитьКодВидаДокументаПоВидуДокумента(ДокументВид) Экспорт 
	
	Если ЗначениеЗаполнено(ДокументВид) Тогда
		Возврат ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ДокументВид, "КодМВД");
	Иначе
		Возврат "";
	КонецЕсли;
	
КонецФункции

//Возвращает уведомление оргнанизации в отчетном году
//Параметры
//Организация - Справочник Организации
//ОтчетныйГод - Число(4,0)
//ТипУведомления - Число(1,0)
//	0 - Уведомление
//	1 - Корректировка
//НомерКорректировки - Число(3,0)
//ТипПоиска - Строка
//	Последний 	- Искать корректировку с наибольшим номером
//	Следующий 	- Искать коректировку с номером "НомерКорректировки" или следующую
//	Предыдущий 	- Искать коректировку с номером "НомерКорректировки" или предидущую
//	Указанный 	- Искать только указанный номер корректировки 
//	(Возвращает неопределено если уведомление  не найдено)
Функция НайтиУведомлениеОрганизацииВОтчетномГоду(Организация, ОтчетныйГод, ТипУведомления = Неопределено, НомерКорректировки = Неопределено, ТипПоиска = "Последний") Экспорт
		
		Запрос = Новый Запрос();
		Запрос.Параметры.Вставить("Организация", Организация);
		Запрос.Параметры.Вставить("ОтчетныйГод", Дата(ОтчетныйГод, 1, 1));
		Запрос.Параметры.Вставить("НомерКорректировки", ?(ТипУведомления = 0, 0, ?(НомерКорректировки = Неопределено,0,НомерКорректировки)));
		
		ТекстЗапроса = 
		"ВЫБРАТЬ
		|	УведомлениеОКонтролируемыхСделках.Ссылка КАК Уведомление,
		|	УведомлениеОКонтролируемыхСделках.НомерКорректировки КАК НомерКорректировки
		|ИЗ
		|	Документ.УведомлениеОКонтролируемыхСделках КАК УведомлениеОКонтролируемыхСделках
		|ГДЕ
		|	УведомлениеОКонтролируемыхСделках.Организация = &Организация
		|	И УведомлениеОКонтролируемыхСделках.ОтчетныйГод = &ОтчетныйГод
		|	И УведомлениеОКонтролируемыхСделках.НомерКорректировки >= &НомерКорректировки
		|	И НЕ УведомлениеОКонтролируемыхСделках.ПометкаУдаления";
		
		Если ТипУведомления = Неопределено и ТипПоиска = "Последний" Тогда
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И УведомлениеОКонтролируемыхСделках.НомерКорректировки >= &НомерКорректировки","");	
		КонецЕсли;
		
		Если ТипПоиска = "Последний" Тогда
			ТекстЗапроса = ТекстЗапроса + "
			|
			|УПОРЯДОЧИТЬ ПО
			|	НомерКорректировки УБЫВ";
		ИначеЕсли ТипПоиска = "Следующий" Тогда
			ТекстЗапроса = ТекстЗапроса + "
			|
			|УПОРЯДОЧИТЬ ПО
			|	НомерКорректировки ВОЗР";
		ИначеЕсли ТипПоиска = "Предыдущий" Тогда
			ТекстЗапроса = ТекстЗапроса + "
			|
			|УПОРЯДОЧИТЬ ПО
			|	НомерКорректировки УБЫВ";
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И УведомлениеОКонтролируемыхСделках.НомерКорректировки >= &НомерКорректировки",
													"И УведомлениеОКонтролируемыхСделках.НомерКорректировки <= &НомерКорректировки");	
		ИначеЕсли ТипПоиска = "Указанный" Тогда
			ТекстЗапроса = СтрЗаменить(ТекстЗапроса,"И УведомлениеОКонтролируемыхСделках.НомерКорректировки >= &НомерКорректировки",
													"И УведомлениеОКонтролируемыхСделках.НомерКорректировки = &НомерКорректировки");	
		КонецЕсли;	
		
		Запрос.Текст = ТекстЗапроса;
		Результат = Запрос.Выполнить().Выбрать();
		
		Если Результат.Следующий() Тогда
			Возврат Результат.Уведомление;
		Иначе
			Возврат Неопределено;
		КонецЕсли;
	
КонецФункции

Функция СписокОфшоров(Знач ОтчетныйГод) Экспорт
	
	МассивКодов = Новый Массив;
	
	Если НЕ ЗначениеЗаполнено(ОтчетныйГод) Тогда
		ОтчетныйГод = НачалоГода(ТекущаяДатаСеанса());
	КонецЕсли;
	
	ОфшорыОтчетногоГода = УчетОфшоров.СтраныОфшорыПоОтчетномуГоду(ОтчетныйГод);
	
	Возврат ОфшорыОтчетногоГода.ВыгрузитьКолонку("СтранаРегистрации");
	
КонецФункции

Функция ТаблицаКодовТНВЭДМировойБиржевойТорговли() Экспорт
	
	Возврат РегистрыСведений.ПредметыКонтролируемыхСделок.КодыТНВЭДМировойБиржевойТорговли();
	
КонецФункции

Функция ПредставлениеУведомления(Уведомление, ШаблонТекста) Экспорт
	
	Если Уведомление = ПредопределенноеЗначение("Документ.УведомлениеОКонтролируемыхСделках.ПустаяСсылка") Тогда
		Возврат НСтр("ru = ''");
	КонецЕсли;
	
	ПараметрыУведомления = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(Уведомление, "Организация, НомерКорректировки, ОтчетныйГод");
	
	Представление = ?(ПараметрыУведомления.НомерКорректировки > 0, 
		НСтр("ru = '%ШаблонТекста% корректировки №%НомерКорректировки% уведомления ""%Организация%"" за %Год%'"),
		НСтр("ru = '%ШаблонТекста% уведомления ""%Организация%"" за %Год%'"));
	Представление = СтрЗаменить(Представление, "%НомерКорректировки%", ПараметрыУведомления.НомерКорректировки);
	Представление = СтрЗаменить(Представление, "%Организация%", ПараметрыУведомления.Организация);
	Представление = СтрЗаменить(Представление, "%Год%", Формат(ПараметрыУведомления.ОтчетныйГод,"ДФ=yyyy"));
	Представление = СтрЗаменить(Представление, "%ШаблонТекста%", ШаблонТекста);
	
	Возврат Представление;
	
КонецФункции

Функция ДатаНачалаУчетаСпецрежимовДляНевзаимозависимыхПосредников() Экспорт
	
	// В соответствии с п.2 ст.4 №227-ФЗ от 18.07.2011 до 2014 года действует переходный период.
	// В переходный период сделки с невзаимозависимыми посредниками (пп.1 п.1 ст.105.14 НК РФ)
	// не учитываются как контролируемые, если сделки совершены с участниками спец.режимов (ЕВНД и ЕСХН)
	Возврат '20140101';
	
КонецФункции

Функция УчитываютсяСделкиСИнвестиционнымНалоговымВычетом(Период) Экспорт
	
	Возврат Период < '20220101' Или Период > '20241231235959';
	
КонецФункции

Функция ДатаОтказаОтЕНВД() Экспорт
	
	// В 2021 году налоговый режим ЕНВД отменен.
	// В контролируемых сделках учет ЕНВД отменен 6-ФЗ от 17.02.2021.
	Возврат '20210101';
	
КонецФункции

#Область ФормированиеДвижений

Процедура СформироватьДвиженияКонтролируемыхСделокОрганизаций(КонтролируемыеСделкиОрганизаций, Движения, Отказ) Экспорт
	
	Движения.КонтролируемыеСделкиОрганизаций.Загрузить(КонтролируемыеСделкиОрганизаций);
	
	Движения.КонтролируемыеСделкиОрганизаций.Записывать = Истина;
	
КонецПроцедуры

#КонецОбласти

#Область НумерацияДокументов

Процедура ПеренумерацияКонтролируемыхСделокУведомления(Уведомление) Экспорт
	
	Запрос = Новый Запрос;
	
	Запрос.Текст = "ВЫБРАТЬ
	               |	КонтролируемаяСделка.Ссылка КАК Документ
	               |ИЗ
	               |	Документ.КонтролируемаяСделка КАК КонтролируемаяСделка
	               |ГДЕ
	               |	КонтролируемаяСделка.УведомлениеОКонтролируемойСделке = &Уведомление
	               |	И НЕ КонтролируемаяСделка.ПометкаУдаления
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	КонтролируемаяСделка.Номер";
	
	Запрос.УстановитьПараметр("Уведомление", Уведомление);
	
	Сч = 1;
	
	Выборка = Запрос.Выполнить().Выбрать();
	СчетчикТранзакции = 0;
	Пока Выборка.Следующий() Цикл
		
		Если Выборка.Документ.Номер <> Сч Тогда
			КонтролируемаяСделка = Выборка.Документ.ПолучитьОбъект();
			КонтролируемаяСделка.Номер = Сч;
			КонтролируемаяСделка.Записать();
		КонецЕсли;
		
		Сч = Сч + 1;
		
	КонецЦикла;
	
КонецПроцедуры	

Функция НомераКонтролируемыхСделокУведомленияКоректны(Уведомление) Экспорт
	
	НомераКорректны = Истина;
	
	Запрос = Новый Запрос;
	
	Запрос.Текст =  "ВЫБРАТЬ
					|	КОЛИЧЕСТВО(КонтролируемаяСделка.Ссылка) КАК Количество,
					|	ЕстьNull(МАКСИМУМ(КонтролируемаяСделка.Номер), 0) КАК МаксимальныйНомер,
					|    КОЛИЧЕСТВО(РАЗЛИЧНЫЕ КонтролируемаяСделка.Номер) КАК КоличествоРазличных
					|ИЗ
					|	Документ.КонтролируемаяСделка КАК КонтролируемаяСделка
					|ГДЕ
					|	КонтролируемаяСделка.УведомлениеОКонтролируемойСделке = &Уведомление
					|	И НЕ КонтролируемаяСделка.ПометкаУдаления";
				   				   
	Запрос.УстановитьПараметр("Уведомление", Уведомление);
	РезультатПроверки = Запрос.Выполнить().Выбрать();			   
	
	Если РезультатПроверки.Следующий() Тогда
		
		НомераКорректны	= (РезультатПроверки.МаксимальныйНомер = РезультатПроверки.Количество 
							И РезультатПроверки.МаксимальныйНомер = РезультатПроверки.КоличествоРазличных);
		
	КонецЕсли;	
				   
	Возврат НомераКорректны;	
	
КонецФункции	

Функция ПолучитьСледующийНомерКонтролируемойСделкиУведомления(Уведомление) Экспорт
	
	Номер = 0;
	
	Запрос = Новый Запрос;
	
	Запрос.Текст =  "ВЫБРАТЬ
					|	ЕстьNull(МАКСИМУМ(КонтролируемаяСделка.Номер), 0) КАК Номер
					|ИЗ
					|	Документ.КонтролируемаяСделка КАК КонтролируемаяСделка
					|ГДЕ
					|	КонтролируемаяСделка.УведомлениеОКонтролируемойСделке = &Уведомление
					|	И НЕ КонтролируемаяСделка.ПометкаУдаления";
			   
				   
				   
	Запрос.УстановитьПараметр("Уведомление", Уведомление);
	Результат = Запрос.Выполнить().Выбрать();			   
	
	Если Результат.Следующий() Тогда
		
		Номер = Результат.Номер;
		
	КонецЕсли;	
				   
	Возврат Номер + 1;	
	
	
КонецФункции	

Процедура ПолучитьЛистыУведомленияВФоне(ПараметрыОтчета, АдресХранилища) Экспорт 
	
	Уведомление = ПараметрыОтчета.Уведомление;
	Результат = ПолучитьЛистыУведомления(Уведомление);
	ПоместитьВоВременноеХранилище(Результат, АдресХранилища);
	
КонецПроцедуры

Процедура ЗаполнитьСписокГоловныхОрганизаций(СписокОрганизаций) Экспорт
	
	СписокОрганизаций.Очистить();
	
	Запрос = Новый Запрос();
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	Организации.Ссылка КАК Ссылка,
	|	Организации.Наименование КАК Наименование
	|ИЗ
	|	Справочник.Организации КАК Организации
	|ГДЕ
	|	Организации.ОбособленноеПодразделение = ЛОЖЬ
	|	И &УсловиеПоОрганизации
	|
	|УПОРЯДОЧИТЬ ПО
	|	Наименование";
	
	Если ОбщегоНазначенияБП.ИспользуетсяАрхив() Тогда
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеПоОрганизации", "НЕ Организации.ВАрхиве");
	Иначе
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "&УсловиеПоОрганизации", "Истина");
	КонецЕсли;
	Выборка = Запрос.Выполнить().Выбрать();
	
	Пока Выборка.Следующий() Цикл
		СписокОрганизаций.Добавить(Выборка.Ссылка, Выборка.Наименование);
	КонецЦикла;
	
КонецПроцедуры

Процедура ПроверитьПравильностьЗаполненияКонтрагентаРегистра(Отказ, ТаблицаЗаписей, ОписаниеКлючаЗаписи) Экспорт
	
	Запрос = Новый Запрос();
	Запрос.Параметры.Вставить("КлючиРегистра", ТаблицаЗаписей);
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	КлючиРегистра.Контрагент КАК Контрагент
	|ПОМЕСТИТЬ КлючиРегистра
	|ИЗ
	|	&КлючиРегистра КАК КлючиРегистра
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Контрагент
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	Контрагенты.Наименование КАК Наименование,
	|	КлючиРегистра.Контрагент КАК Контрагент
	|ИЗ
	|	Справочник.Контрагенты КАК Контрагенты
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ КлючиРегистра КАК КлючиРегистра
	|		ПО Контрагенты.Ссылка = КлючиРегистра.Контрагент
	|ГДЕ
	|	Контрагенты.Ссылка В
	|			(ВЫБРАТЬ
	|				КлючиРегистра.Контрагент
	|			ИЗ
	|				КлючиРегистра КАК КлючиРегистра)
	|	И Контрагенты.ОбособленноеПодразделение = ИСТИНА";
	
	ПоляКлюча = "";
	Для Каждого ОписаниеКлюча Из ОписаниеКлючаЗаписи Цикл
		ПоляКлюча = ПоляКлюча + ?(ПоляКлюча = "", "", ", ") + ОписаниеКлюча.Ключ + " КАК " + ОписаниеКлюча.Ключ;
	КонецЦикла;
	
	Запрос.Текст = СтрЗаменить(ТекстЗапроса, "КлючиРегистра.Контрагент КАК Контрагент", ПоляКлюча);
	
	Ошибка = Запрос.Выполнить().Выбрать();
	
	Пока Ошибка.Следующий() Цикл
		
		ТекстСообщения = НСтр("ru = 'Контрагент ""%1"" является обособленным подразделением. Можно выбирать только головного контрагента'");
		ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, Ошибка.Наименование);
		
		ЗаполнитьЗначенияСвойств(ОписаниеКлючаЗаписи, Ошибка);
		КлючЗаписи = РегистрыСведений.ВзаимозависимыеЛица.СоздатьКлючЗаписи(ОписаниеКлючаЗаписи);
		
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, КлючЗаписи, "Запись.Контрагент", , Отказ);
		
	КонецЦикла;

	
КонецПроцедуры

#КонецОбласти

#Область ПечатьУведомления

Функция ПечатьКонтролируемыхСделок(МассивСделок, ОбъектыПечати) Экспорт
	
	ТабличныйДокументЛисты1А = Новый ТабличныйДокумент;
	ТабличныйДокументЛисты1А.АвтоМасштаб         = Истина;
	ТабличныйДокументЛисты1А.ПолеСверху          = 5;
	ТабличныйДокументЛисты1А.ПолеСнизу           = 5;
	ТабличныйДокументЛисты1А.ОриентацияСтраницы  = ОриентацияСтраницы.Портрет;
	ТабличныйДокументЛисты1А.КлючПараметровПечати = "Документ.УведомлениеОКонтролируемыхСделках";
	
	Если НЕ ЗначениеЗаполнено(МассивСделок) Тогда
		Возврат ТабличныйДокументЛисты1А;
	КонецЕсли;
	
	Для Каждого КонтролируемаяСделка ИЗ МассивСделок Цикл
		ПечатьКонтролируемойСделки(КонтролируемаяСделка, ТабличныйДокументЛисты1А, ОбъектыПечати);
	КонецЦикла;
	
	Возврат ТабличныйДокументЛисты1А;

КонецФункции

Функция ЛистУведомления(НомерЛиста, ЛистыУведомления, СведенияОбУведомлении)
	
	Лист = ЛистыУведомления.Листы[НомерЛиста - 1];
	
	ИменаМакетов = СведенияОбУведомлении.ПараметрыВерсии.Макеты;
	Макет = Документы.УведомлениеОКонтролируемыхСделках.ПолучитьМакет(ИменаМакетов[Лист.Раздел]);
	УстановитьНомерСтраницы(Макет, НомерЛиста, СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераСтраница);
	
	Если Лист.Раздел = "ТитульныйЛист" Тогда
		ДанныеЛиста = ДанныеЗаполненияЛиста1(СведенияОбУведомлении);
	ИначеЕсли Лист.Раздел = "ТитульныйЛистФизическоеЛицо" Тогда
		ДанныеЛиста = ДанныеЗаполненияЛиста2(СведенияОбУведомлении);
	ИначеЕсли Лист.Раздел = "Лист1А" Тогда
		Лист1А = ЛистыУведомления.ЛистыРаздела1А[Лист.НомерСтрокиРаздела];
		ДанныеЛиста = ДанныеЗаполненияЛиста1А(СведенияОбУведомлении, Лист1А);
	ИначеЕсли Лист.Раздел = "Лист1Б" Тогда
		Лист1Б = ЛистыУведомления.ЛистыРаздела1Б[Лист.НомерСтрокиРаздела];
		ДанныеЛиста = ДанныеЗаполненияЛиста1Б(СведенияОбУведомлении, Лист1Б);
	ИначеЕсли Лист.Раздел = "Лист1В" Тогда
		Лист1В = ЛистыУведомления.ЛистыРаздела1В[Лист.НомерСтрокиРаздела];
		ДанныеЛиста = ДанныеЗаполненияЛиста1В(СведенияОбУведомлении, Лист1В);
	ИначеЕсли Лист.Раздел = "Лист1Г" Тогда
		Лист1Г = ЛистыУведомления.ЛистыРаздела1ГСдвоенные[Лист.НомерСтрокиРаздела];
		ДанныеЛиста = ДанныеЗаполненияЛиста1Г(СведенияОбУведомлении, Лист1Г);
	ИначеЕсли Лист.Раздел = "Раздел2" Тогда
		Лист2 = ЛистыУведомления.ЛистыРаздела2[Лист.НомерСтрокиРаздела];
		ДанныеРаздела2 = ЛистыУведомления.ДанныеРаздела2;
		ДанныеЛиста = ДанныеЗаполненияРаздела2(СведенияОбУведомлении, Лист2, ДанныеРаздела2);
	ИначеЕсли Лист.Раздел = "Раздел3" Тогда
		Лист3 = ЛистыУведомления.ЛистыРаздела3[Лист.НомерСтрокиРаздела];
		ДанныеРаздела3 = ЛистыУведомления.ДанныеРаздела3;
		ДанныеЛиста = ДанныеЗаполненияРаздела3(СведенияОбУведомлении, Лист3, ДанныеРаздела3);
	ИначеЕсли Лист.Раздел = "Раздел4" Тогда
		ДанныеРаздела4 = ЛистыУведомления.ДанныеРаздела4[Лист.НомерСтрокиРаздела];
		ДанныеЛиста = ДанныеЗаполненияРаздела4(СведенияОбУведомлении, ДанныеРаздела4);
	КонецЕсли;
	
	Если ЗначениеЗаполнено(ДанныеЛиста) Тогда
		ЗаполнитьЗначенияСвойств(Макет.Параметры, ДанныеЛиста);
	КонецЕсли;
	
	Возврат Макет;
	
КонецФункции

Процедура СформироватьЛистыУведомления(ЛистыУведомления, СведенияОбУведомлении, ПервыйЛист, ПоследнийЛист, ТабличныйДокумент) Экспорт
	
	Для НомерЛиста = ПервыйЛист По ПоследнийЛист Цикл
		
		ЛистУведомления = ЛистУведомления(НомерЛиста, ЛистыУведомления, СведенияОбУведомлении);
		
		ТабличныйДокумент.Вывести(ЛистУведомления);
		ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
		
	КонецЦикла
	
КонецПроцедуры

Процедура ПечатьКонтролируемойСделки(КонтролируемаяСделка, ТабДокумент, ОбъектыПечати)
	
	Если НЕ ЗначениеЗаполнено(КонтролируемаяСделка) Тогда
		Возврат;
	КонецЕсли;
	
	Если ТабДокумент.ВысотаТаблицы > 0 Тогда
		ТабДокумент.ВывестиГоризонтальныйРазделительСтраниц();
	КонецЕсли;
	
	НомерСтрокиНачало = ТабДокумент.ВысотаТаблицы + 1;
	
	Уведомление = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(КонтролируемаяСделка, "УведомлениеОКонтролируемойСделке");
	
	СведенияОбУведомлении = Документы.УведомлениеОКонтролируемыхСделках.ПолучитьСведенияОбУведомлении(Уведомление);
	
	ЛистыУведомления = КонтролируемыеСделки.ПолучитьЛистыУведомления(Уведомление, КонтролируемаяСделка);
	Листы = ЛистыУведомления.Листы;
	
	Если Листы.Количество()>1 
		И Листы[1].Раздел = "ТитульныйЛистФизическоеЛицо" Тогда
		ПервыйЛист = 3;
	Иначе
		ПервыйЛист = 2;
	КонецЕсли;
	
	СформироватьЛистыУведомления(ЛистыУведомления, СведенияОбУведомлении, ПервыйЛист, ЛистыУведомления.Листы.Количество(), ТабДокумент);
	
	УправлениеПечатью.ЗадатьОбластьПечатиДокумента(ТабДокумент, 
		НомерСтрокиНачало, ОбъектыПечати, КонтролируемаяСделка);
	
КонецПроцедуры

Функция ПакетЛистовУведомленияДляПечати(ЛистыУведомления, СведенияОбУведомлении, ПервыйЛист, ПоследнийЛист, УникальныйИдентификаторФормы) Экспорт
	
	ПакетЛистов = Новый ПакетОтображаемыхДокументов;
	
	Для НомерЛиста = ПервыйЛист По ПоследнийЛист Цикл
		
		ЛистУведомления = ЛистУведомления(НомерЛиста, ЛистыУведомления, СведенияОбУведомлении);
		
		ТабличныйДокумент = Новый ТабличныйДокумент;
		ТабличныйДокумент.Вывести(ЛистУведомления);
		
		УстановитьПараметрыПечатиУведомления(ТабличныйДокумент);
		
		ПакетЛистов.Состав.Добавить().Данные = ПоместитьВоВременноеХранилище(ТабличныйДокумент, УникальныйИдентификаторФормы);
		
	КонецЦикла;
	
	Возврат ПакетЛистов
	
КонецФункции

#Область ДанныеЗаполнения

Функция ДанныеЗаполненияЛиста1(СведенияОбУведомлении)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "СтраницВсего_", СведенияОбУведомлении.ВсегоЛистов,
		СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераСтраница, 0);
	
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерКорректировки_", СведенияОбУведомлении.НомерКорректировки, 3, 0);
	
	ОсновныеСведенияВыгрузки = Документы.УведомлениеОКонтролируемыхСделках.ПолучитьОсновныеСведенияУведомленияДляВыгрузки(СведенияОбУведомлении.Уведомление);
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Налогоплательщик_", ОсновныеСведенияВыгрузки.НаименованиеДляЛиста1, 160, 40);
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОтчетныйГод_", ОсновныеСведенияВыгрузки.ОтчетГод);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НомерКонтактногоТелефона_", ОсновныеСведенияВыгрузки.Тлф);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ЭлектроннаяПочта_", ОсновныеСведенияВыгрузки.ЭлПочта);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодНО_", ОсновныеСведенияВыгрузки.КодНО);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодМестаПредставления_", ОсновныеСведенияВыгрузки.ПоМесту);
	
	Если ОсновныеСведенияВыгрузки.Свойство("ОКВЭД") Тогда
		ОКВЭД = РазложитьОКВЭДВСтроку(ОсновныеСведенияВыгрузки.ОКВЭД);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОКВЭД_", ОКВЭД);
	КонецЕсли;
	
	Если ОсновныеСведенияВыгрузки.Свойство("ОКАТО") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодПоОКАТО_", ОсновныеСведенияВыгрузки.ОКАТО);
	КонецЕсли;
	
	Если ОсновныеСведенияВыгрузки.Свойство("ОКТМО") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодПоОКТМО_", ОсновныеСведенияВыгрузки.ОКТМО);
	КонецЕсли;
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ПрПодп_", ОсновныеСведенияВыгрузки.ПрПодп);
	
	Если ОсновныеСведенияВыгрузки.Свойство("ПодпФамилия") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОргПодписантФамилия_", ОсновныеСведенияВыгрузки.ПодпФамилия);
	КонецЕсли;
	Если ОсновныеСведенияВыгрузки.Свойство("ПодпИмя") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОргПодписантИмя_", ОсновныеСведенияВыгрузки.ПодпИмя);
	КонецЕсли;
	Если ОсновныеСведенияВыгрузки.Свойство("ПодпОтчество") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОргПодписантОтчество_", ОсновныеСведенияВыгрузки.ПодпОтчество);
	КонецЕсли;
	Если ОсновныеСведенияВыгрузки.Свойство("НаимДокПодп") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ДокУпПред_", ОсновныеСведенияВыгрузки.НаимДокПодп);
	КонецЕсли;
	Если ОсновныеСведенияВыгрузки.Свойство("НаимОргПодп") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОргУп_", ОсновныеСведенияВыгрузки.НаимОргПодп);
	КонецЕсли;
	
	Если ОсновныеСведенияВыгрузки.Свойство("ФормРеорг") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ФормРеорг_", ОсновныеСведенияВыгрузки.ФормРеорг);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ИННЮЛРеорг_", ОсновныеСведенияВыгрузки.ИННЮЛРеорг);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КППЮЛРеорг_", ОсновныеСведенияВыгрузки.КППЮЛРеорг);
	КонецЕсли;
	
	ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаПодписи", ТекущаяДатаСеанса());
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияЛиста2(СведенияОбУведомлении)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	
	ДатаОкончания = КонецГода(СведенияОбУведомлении.ОтчетныйГод);
	ФизическоеЛицо = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(СведенияОбУведомлении.Организация, "ИндивидуальныйПредприниматель");
	Если Не ЗначениеЗаполнено(ФизическоеЛицо) Тогда 
		Возврат ДанныеЗаполнения;
	КонецЕсли;
	
	ОсновныеСведенияВыгрузки = Документы.УведомлениеОКонтролируемыхСделках.ПолучитьОсновныеСведенияУведомленияДляВыгрузки(СведенияОбУведомлении.Уведомление);
	
	ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаРождения_", ОсновныеСведенияВыгрузки.НПФЛДатаРожд);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "МестоРождения_", ОсновныеСведенияВыгрузки.НПФЛМестоРожд);
	ДанныеЗаполнения.Вставить("Гражданство", ОсновныеСведенияВыгрузки.НПФЛНалГражд);
	Если ОсновныеСведенияВыгрузки.Свойство("НПФЛОКСМ") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодОКСМ_", ОсновныеСведенияВыгрузки.НПФЛОКСМ);
	КонецЕсли;
	Если ОсновныеСведенияВыгрузки.Свойство("НПФЛКодВидДок") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодВидаДокумента_", ОсновныеСведенияВыгрузки.НПФЛКодВидДок);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "СерияНомер_", ОсновныеСведенияВыгрузки.НПФЛСерНомДок);
		ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаВыдачи_", ОсновныеСведенияВыгрузки.НПФЛДатаДок);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОрганВыдавшийДокумент_", ОсновныеСведенияВыгрузки.НПФЛВыдДок);
	КонецЕсли;
	
	ДанныеЗаполнения.Вставить("СтатусНалогоплательщика", ОсновныеСведенияВыгрузки.НПФЛСтатусНП);
	Если СведенияОбУведомлении.ВерсияУведомления < КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018()
		И ОсновныеСведенияВыгрузки.Свойство("НПФЛПрАдр") Тогда
		ДанныеЗаполнения.Вставить("МестоЖительства", ОсновныеСведенияВыгрузки.НПФЛПрАдр);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Индекс_", ОсновныеСведенияВыгрузки.НПФЛИндекс);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "РегионКод_", ОсновныеСведенияВыгрузки.НПФЛКодРегион);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Район_", ОсновныеСведенияВыгрузки.НПФЛРайон);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Город_", ОсновныеСведенияВыгрузки.НПФЛГород);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаселенныйПункт_", ОсновныеСведенияВыгрузки.НПФЛНаселПункт);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Улица_", ОсновныеСведенияВыгрузки.НПФЛУлица);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Дом_", ОсновныеСведенияВыгрузки.НПФЛДом);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НПФЛКорпус", ОсновныеСведенияВыгрузки.Корпус_);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НПФЛКварт", ОсновныеСведенияВыгрузки.Квартира_);
	КонецЕсли;
	
	Если ОсновныеСведенияВыгрузки.Свойство("АдрИнКодСтраны") Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодСтраныОКСМ_", ОсновныеСведенияВыгрузки.АдрИнКодСтраны);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресЗаПределамиРФ_", ОсновныеСведенияВыгрузки.АдрИнТекст);
	КонецЕсли;
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияЛиста1А(СведенияОбУведомлении, Лист1А)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	
	ДанныеЗаполнения.Вставить("Сделка", Лист1А.Сделка);
	
	ДлинаНомераЛистовРаздела1 = СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераЛистовРаздела1;
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1А_", Лист1А.НомерЛиста1А, ДлинаНомераЛистовРаздела1, 0);
	
	Если СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДанныеЗаполнения.Вставить("СделкаОтИмениКомиссионера", Лист1А.СделкаСовАгент);
	КонецЕсли;
	
	ДанныеЗаполнения.Вставить("П100", Лист1А.Строка100Взаимозависимость);
	ДанныеЗаполнения.Вставить("П121", Лист1А.Строка121СтороныВзаимозависимыПоКодексу);
	ДанныеЗаполнения.Вставить("П122", Лист1А.Строка122СделкаВОбластиВнешнейТорговли);
	ДанныеЗаполнения.Вставить("П123", Лист1А.Строка123СделкаСКонтрагентомСЛьготнымНалогообложением);
	ДанныеЗаполнения.Вставить("П124", Лист1А.Строка124СделкаСНезависимымПосредником);
	
	ДанныеЗаполнения.Вставить("П131", Лист1А.ОснованиеКонтролируемости131);
	ДанныеЗаполнения.Вставить("П132", Лист1А.ОснованиеКонтролируемости132);
	ДанныеЗаполнения.Вставить("П133", Лист1А.ОснованиеКонтролируемости133);
	ДанныеЗаполнения.Вставить("П134", Лист1А.ОснованиеКонтролируемости134);
	ДанныеЗаполнения.Вставить("П135", Лист1А.ОснованиеКонтролируемости135);
	
	Если СведенияОбУведомлении.ВерсияУведомления = КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДанныеЗаполнения.Вставить("П136", Лист1А.ОснованиеКонтролируемости136);
		ДанныеЗаполнения.Вставить("П137", Лист1А.ОснованиеКонтролируемости137);
		ДанныеЗаполнения.Вставить("П138", Лист1А.ОснованиеКонтролируемости138);
		ДанныеЗаполнения.Вставить("П139", Лист1А.ОснованиеКонтролируемости139);
		ДанныеЗаполнения.Вставить("П140", Лист1А.ОснованиеКонтролируемости140);
	ИначеЕсли СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2019() Тогда
		ДанныеЗаполнения.Вставить("П136", Лист1А.ОснованиеКонтролируемости136);
		ДанныеЗаполнения.Вставить("П137", Лист1А.ОснованиеКонтролируемости137);
		ДанныеЗаполнения.Вставить("П138", Лист1А.ОснованиеКонтролируемости138);
	КонецЕсли;
	
	ДанныеЗаполнения.Вставить("П200", "0");
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П210_", Лист1А.Строка210КодНаименованияСделки);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П211_", Лист1А.Строка211КодСтороныСделки);
	
	ДанныеЗаполнения.Вставить("КодТипаСделки1", Строка(Лист1А.КодТипаСделки1));
	ДанныеЗаполнения.Вставить("КодТипаСделки2", Строка(Лист1А.КодТипаСделки2));
	ДанныеЗаполнения.Вставить("КодТипаСделки3", Строка(Лист1А.КодТипаСделки3));
	
	ДанныеЗаполнения.Вставить("П220", Лист1А.Строка220ПризнакОпределенияЦеныСделки);
	ДанныеЗаполнения.Вставить("П2201", Лист1А.Строка220_1Комментарий);
	ДанныеЗаполнения.Вставить("П230", Лист1А.Строка230КодОпределенияЦены);
	ДанныеЗаполнения.Вставить("П2301", Лист1А.Строка230_1Комментарий);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П240_", Лист1А.Строка240КодМетодовЦенообразования);
	ДанныеЗаполнения.Вставить("П2401", Лист1А.Строка240_1Комментарий);
	
	ДанныеЗаполнения.Вставить("П251", Лист1А.Строка251);
	ДанныеЗаполнения.Вставить("П252", Лист1А.Строка252);
	ДанныеЗаполнения.Вставить("П253", Лист1А.Строка253);
	ДанныеЗаполнения.Вставить("П254", Лист1А.Строка254);
	ДанныеЗаполнения.Вставить("П255", Лист1А.Строка255);
	ДанныеЗаполнения.Вставить("П256", Лист1А.Строка256);
	ДанныеЗаполнения.Вставить("П257", Лист1А.Строка257);
	ДанныеЗаполнения.Вставить("П258", Лист1А.Строка258);
	ДанныеЗаполнения.Вставить("П259", Лист1А.Строка259);
	
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П260_", Лист1А.Строка260КоличествоУчастниковСделки, 3, 0);
	ДанныеЗаполнения.Вставить("П2601", Лист1А.Строка260_1Комментарий);
	
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П300_", Лист1А.Строка300СуммаДоходов, 15, 0);
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П301_", Лист1А.Строка301СуммаРегулируемыхДоходов, 15, 0);
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П310_", Лист1А.Строка310СуммаРасходов, 15, 0);
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П311_", Лист1А.Строка311СуммаРегулируемыхРасходов, 15, 0);
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияЛиста1Б(СведенияОбУведомлении, Лист1Б)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	
	ДанныеЗаполнения.Вставить("Сделка", Лист1Б.Сделка);
	
	ДлинаНомераЛистовРаздела1 = СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераЛистовРаздела1;
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1А_", Лист1Б.НомерЛиста1А, ДлинаНомераЛистовРаздела1, 0);
	Если ЗначениеЗаполнено(Лист1Б.НомерЛиста1Б) Тогда
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1Б_", Лист1Б.НомерЛиста1Б, ДлинаНомераЛистовРаздела1, 0);
	КонецЕсли;
	
	ДанныеЗаполнения.Вставить("П020", Лист1Б.Строка020ТипПредмета);
	
	Если СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2024()
		И ЗначениеЗаполнено(Лист1Б.УникальныйНомерВалютногоКонтроля) Тогда
		НормализованныйУникальныйНомерВалютногоКонтроля = СтрЗаменить(Лист1Б.УникальныйНомерВалютногоКонтроля, "/", "");
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "УникальныйНомерДоговора_", НормализованныйУникальныйНомерВалютногоКонтроля);
	КонецЕсли;
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П030_", Лист1Б.Строка030НаименованиеПредмета);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П040_", Лист1Б.Строка040КодПоТНВЭД);
	
	Если СведенияОбУведомлении.ВерсияУведомления = КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2012() Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П043_", Лист1Б.Строка043КодПоОКП);
	ИначеЕсли СведенияОбУведомлении.ВерсияУведомления = КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2017() Тогда
		КодОКПД2 = КодПоОКПИзКодаПоОКПД2(Лист1Б.Строка043КодПоОКПД2);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П043_", КодОКПД2);
	Иначе
		КодОКПД2 = РазложитьОКПД2ВСтроку(Лист1Б.Строка043КодПоОКПД2);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П043_", КодОКПД2);
	КонецЕсли;
	
	Если СведенияОбУведомлении.ВерсияУведомления = КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2012() Тогда
		КодОКВЭД = РазложитьОКВЭДВСтроку(Лист1Б.Строка045КодОКВЭД);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П045_", КодОКВЭД);
	Иначе
		КодОКВЭД = РазложитьОКВЭДВСтроку(Лист1Б.Строка045КодОКВЭД2);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П045_", КодОКВЭД);
	КонецЕсли;
	
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П050_", Лист1Б.Строка050НомерУчастникаСделки, 4, 0);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П060_", Лист1Б.Строка060НомерДоговора);
	ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "П065_", Лист1Б.Строка065ДатаДоговора);
	
	КодСтраныПроисхождения = "";
	Если СведенияОбУведомлении.ВерсияУведомления < КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2024()
		Или Документы.УведомлениеОКонтролируемыхСделках.НужноЗаполнятьСтрануПроисхождения2024(Лист1Б) Тогда
		КодСтраныПроисхождения = Лист1Б.Строка070КодСтраныПроисхождения;
	КонецЕсли;
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П070_", КодСтраныПроисхождения);
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П080_С_", Лист1Б.Строка080КодСтраныОтправки);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П080_Р_", Лист1Б.Строка080КодРегионаОтправки);
	
	Если СведенияОбУведомлении.ВерсияУведомления < КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П080_Г_", Лист1Б.Строка080ГородОтправки);
	КонецЕсли;
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П080_Н_", Лист1Б.Строка080НаселенныйПунктОтправки);
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П090_С_", Лист1Б.Строка090КодСтраныСовершенияСделки);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П090_Р_", Лист1Б.Строка090КодРегионаСовершенияСделки);
	
	Если СведенияОбУведомлении.ВерсияУведомления < КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П090_Г_", Лист1Б.Строка090ГородСовершенияСделки);
	КонецЕсли;
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П090_Н_", Лист1Б.Строка090НаселенныйПунктСовершенияСделки);
	
	Если СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2024() Тогда
		КодПунктаПоставкиОКТМО = "";
		Если Лист1Б.Строка020ТипПредмета = 1 И КодСтраныПроисхождения = "643" Тогда
			КодПунктаПоставкиОКТМО = Лист1Б.ОКТМОСовершенияСделки;
		КонецЕсли;
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодПунктаПоставкиОКТМО_", КодПунктаПоставкиОКТМО);
		Если Не ЗначениеЗаполнено(КодПунктаПоставкиОКТМО) Тогда
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "МестоСовершенияСделки_", Лист1Б.Строка090НаселенныйПунктСовершенияСделки);
		КонецЕсли;
	КонецЕсли;
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П100_", Лист1Б.Строка100КодУсловийПоставки);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П110_", Лист1Б.Строка110КодЕдиницыИзмерения);
	
	Если СведенияОбУведомлении.ВерсияУведомления < КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П120_", Лист1Б.Строка120Количество, 15, 0);
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П130_", Лист1Б.Строка130Цена, 15, 0);
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П140_", Лист1Б.Строка140Стоимость, 15, 0);
	Иначе
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П120_", Лист1Б.Строка120Количество, 9, 5);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "П140_", Лист1Б.Строка140КодВалюты);
		Если Лист1Б.ТипПредметаСделки = Перечисления.ТипыПредметовКонтролируемыхСделок.ДолговоеОбязательство Тогда
			ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П150_", Лист1Б.Строка150ПроцентнаяСтавка, 3, 4);
		Иначе
			ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "СуммаРоялти_", Лист1Б.СуммаБазыДляРасчетаРоялти, 15, 0);
			ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П130_", Лист1Б.Строка130Цена, 14, 4);
			ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "П160_", Лист1Б.Строка160Стоимость, 15, 0);
		КонецЕсли;
	КонецЕсли;
	
	ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаСовершенияСделки_", Лист1Б.Строка150ДатаСовершения);
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияЛиста1В(СведенияОбУведомлении, Лист1В)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	
	ДанныеЗаполнения.Вставить("Сделка", Лист1В.Сделка);
	
	ДлинаНомераЛистовРаздела1 = СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераЛистовРаздела1;
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1А_", Лист1В.НомерЛиста1А, ДлинаНомераЛистовРаздела1, 0);
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1Б_", Лист1В.НомерЛиста1Б, ДлинаНомераЛистовРаздела1, 0);
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "СправочнноКНомеруЛиста1Б_", Лист1В.СправочноНомераЛистов1Б);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КомментарийКНомеруЛиста1Б_", Лист1В.КомментарийКЛисту1Б);
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1В_", Лист1В.НомерЛиста1В_0);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1В_2_", Лист1В.НомерЛиста1В_1);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1В_3_", Лист1В.НомерЛиста1В_2);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1В_4_", Лист1В.НомерЛиста1В_3);
	
	ДанныеЗаполнения.Вставить("ВзаимозависимостьУчастников", Лист1В.УчастникиВзаимозависимы);
	
	ДанныеЗаполнения.Вставить("КодТипаСделки", Лист1В.КодТипаСделки);
	
	ДанныеЗаполнения.Вставить("КодПроисхожденияТовара",
		Перечисления.ТипыИспользованияПроисхожденияТовараКонтролируемыхСделок.КодДляВыгрузки(Лист1В.ИспользованиеПроисхождениеТовара));
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаименованиеПроисхожденияТовара_", Лист1В.НаименованиеИспользованияПроисхожденияТовара);
	
	Если Перечисления.ТипыИспользованияПроисхожденияТовараКонтролируемыхСделок.НужноВыгружатьСведенияОСделке(Лист1В.ИспользованиеПроисхождениеТовара) Тогда
		
		КодПризнакаУчастника = Перечисления.ТипыУчастниковЦепочкиКонтролируемыхСделок.КодДляВыгрузки(Лист1В.ПризнакУчастникаСделки);
		
		ДанныеЗаполнения.Вставить("ПризнакУчастникаСделки", КодПризнакаУчастника);
		
		Если КодПризнакаУчастника <> "3" Тогда
		
			ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерДругогоУчастникаСделки_", Лист1В.НомерУчастникаСделки, 4, 0);
			
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НомерДоговора_", Лист1В.НомерДоговора);
			ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаДоговора_", Лист1В.ДатаДоговора);
			
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодУсловийПоставки_", Лист1В.КодУсловийПоставки);
			
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодПунктаПоставкиОКТМО_", Лист1В.ОКТМОСовершенияСделки);
			
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодСтраны_", Лист1В.КодСтраныСовершенияСделки);
			
			ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "Цена_", Лист1В.Цена, 14, 4);
			
		КонецЕсли;
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодЕдиницыИзмерения_", Лист1В.КодЕдиницыИзмерения);
		
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "Количество_", Лист1В.Количество, 9, 5);
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодВалюты_", Лист1В.КодВалюты);
		
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "Стоимость_", Лист1В.Стоимость, 13, 0);
		
		ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаСовершенияСделки_", Лист1В.ДатаСовершенияСделки);
		
	КонецЕсли;
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияЛиста1Г(СведенияОбУведомлении, Лист1Г)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	
	ДанныеЗаполнения.Вставить("Сделка", Лист1Г.Сделка);
	
	ДлинаНомераЛистовРаздела1 = СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераЛистовРаздела1;
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1А_", Лист1Г.НомерЛиста1А, ДлинаНомераЛистовРаздела1, 0);
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1Б_", Лист1Г.НомерЛиста1Б, ДлинаНомераЛистовРаздела1, 0);
	
	Для НомерПодЛиста = 1 По 2 Цикл
		НомерСтрокой = Формат(НомерПодЛиста, "ЧДЦ=0; ЧГ=0");
		
		Если Лист1Г["УчастникиВзаимозависимы" + НомерСтрокой] = Неопределено Тогда
			Продолжить;
		КонецЕсли;
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаименованиеУслуги_" + НомерСтрокой + "_",
			Лист1Г["НаименованиеУслуги" + НомерСтрокой]);
		
		ДанныеЗаполнения.Вставить("ВзаимозависимостьУчастников_" + НомерСтрокой, Лист1Г["УчастникиВзаимозависимы" + НомерСтрокой]);
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаименованиеКонтрагента_" + НомерСтрокой + "_",
			Лист1Г["НаименованиеКонтрагента" + НомерСтрокой]);
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "РегистрационныйНомер_" + НомерСтрокой + "_",
			Лист1Г["РегистрационныйНомер" + НомерСтрокой]);
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодСтраны_" + НомерСтрокой + "_",
			Лист1Г["КодСтраныРегистрации" + НомерСтрокой]);
		
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "Стоимость_" + НомерСтрокой + "_",
			Лист1Г["Стоимость" + НомерСтрокой], 13, 0);
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодВалюты_" + НомерСтрокой + "_",
			Лист1Г["КодВалюты" + НомерСтрокой]);
		
	КонецЦикла;
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияРаздела2(СведенияОбУведомлении, Лист2, ДанныеРаздела2)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	ДанныеЗаполнения.Вставить("Сделка", Лист2.Сделка);
	
	Если СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДанныеЗаполнения.Вставить("СведенияОКомиссионере", Лист2.СведОтносительноАгента);
	КонецЕсли;
	
	СведенияОКонтрагенте = ДанныеРаздела2.Найти(Лист2.Контрагент, "Контрагент");
	Если СведенияОКонтрагенте = Неопределено Тогда
		Возврат ДанныеЗаполнения;
	КонецЕсли;
	
	ДлинаНомераЛистовРаздела1 = СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераЛистовРаздела1;
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1А_", Лист2.НомерЛиста1А, ДлинаНомераЛистовРаздела1, 0);
	Если Не Лист2.СведенияОКомиссионере Тогда
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "ПорядковыйНомерУчастника_", СведенияОКонтрагенте.НомерКонтрагента, 4, 0);
	Иначе
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "ПорядковыйНомерУчастника_", 0, 4, 0);
	КонецЕсли;
	
	ДанныеЗаполнения.Вставить("ТипОрганизации", Строка(СведенияОКонтрагенте.Строка020ТипОрганизации));
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодСтраны_", СведенияОКонтрагенте.Строка030КакКодСтраныРегистрации);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаименованиеКонтрагента_", СведенияОКонтрагенте.Строка040Наименование);
	
	Если СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаименованиеКонтрагента_Лат_", СведенияОКонтрагенте.Строка040НаименованиеЛат);
	КонецЕсли;
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ИНН_Контрагента_", СведенияОКонтрагенте.Строка050ИНН);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КПП_Контрагента_", СведенияОКонтрагенте.Строка060КПП);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "РегистрационныйНомерКонтрагента_", СведенияОКонтрагенте.Строка070РегНомерВСтрокеРегистрации);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НалоговыйРегистрационныйНомерКонтрагента_", СведенияОКонтрагенте.НалоговыйРегистрационныйНомер);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаименованиеИдентификатора_", СведенияОКонтрагенте.НаименованиеИдентификатораРегистрационногоНомера);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодНалогоплательщикаКонтрагента_", СведенияОКонтрагенте.Строка080КодНалогВСтранеРегистрации);
	
	Если СведенияОКонтрагенте.Строка020ТипОрганизации <> 1 Тогда
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресИностраннойОрганизации_", СведенияОКонтрагенте.Строка090АдресИностраннойОрганизации);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресИностранный_УлицаДом_", СведенияОКонтрагенте.АдресИностранный_УлицаДом);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресИностранный_Район_", СведенияОКонтрагенте.АдресИностранный_Район);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресИностранный_НаселенныйПункт_", СведенияОКонтрагенте.АдресИностранный_НаселенныйПункт);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресИностранный_Регион_", СведенияОКонтрагенте.АдресИностранный_Регион);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресИностранный_Страна_", СведенияОКонтрагенте.АдресИностранный_Страна);
	КонецЕсли;
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияРаздела3(СведенияОбУведомлении, Лист3, ДанныеРаздела3)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	ДанныеЗаполнения.Вставить("Сделка", Лист3.Сделка);
	
	Если СведенияОбУведомлении.ВерсияУведомления >= КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
		ДанныеЗаполнения.Вставить("СведенияОКомиссионере", Лист3.СведОтносительноАгента);
	КонецЕсли;
	
	СведенияОФизическомЛице = ДанныеРаздела3.Найти(Лист3.Контрагент, "Контрагент");
	Если СведенияОФизическомЛице = Неопределено Тогда
		Возврат ДанныеЗаполнения;
	КонецЕсли;
	
	
	ДлинаНомераЛистовРаздела1 = СведенияОбУведомлении.ПараметрыВерсии.ДлинаНомераЛистовРаздела1;
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "НомерЛиста1А_", Лист3.НомерЛиста1А, ДлинаНомераЛистовРаздела1, 0);
	Если Не Лист3.СведенияОКомиссионере Тогда
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "ПорядковыйНомерУчастника_", СведенияОФизическомЛице.НомерКонтрагента, 4, 0);
	Иначе
		ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "ПорядковыйНомерУчастника_", 0, 4, 0);
	КонецЕсли;
	
	ДанныеЗаполнения.Вставить("КодВидаДеятельности", СведенияОФизическомЛице.Строка020КодВидаДеятельности);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ИННФизлица_", СведенияОФизическомЛице.Строка030ИНН);
	
	Контрагент = СведенияОФизическомЛице.Контрагент;
	ФизическоеЛицо = СведенияОФизическомЛице.ФизическоеЛицо;
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Фамилия_", СведенияОФизическомЛице.Фамилия);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Имя_", СведенияОФизическомЛице.Имя);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Отчество_", СведенияОФизическомЛице.Отчество);
	
	Если НЕ ЗначениеЗаполнено(СведенияОФизическомЛице.Строка030ИНН) Тогда
		
		ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаРождения_", ФизическоеЛицо.ДатаРождения);
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "МестоРождения_",
			ПерсонифицированныйУчетКлиентСервер.ПредставлениеМестаРождения(ФизическоеЛицо.МестоРождения));
		
		Если СведенияОбУведомлении.ВерсияУведомления < КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
			Если ЗначениеЗаполнено(СведенияОФизическомЛице.ГражданствоФизЛицСтрана) Тогда
				ДанныеЗаполнения.Вставить("Гражданство", "1");
				ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодОКСМ_", СведенияОФизическомЛице.ГражданствоФизЛицСтрана.Код);
			Иначе
				ДанныеЗаполнения.Вставить("Гражданство", "2");
			КонецЕсли;
		Иначе
			СведенияОГражданстве = Документы.УведомлениеОКонтролируемыхСделках.СведенияОГражданстве2018(СведенияОФизическомЛице.ГражданствоФизЛицСтрана);
			ДанныеЗаполнения.Вставить("Гражданство", СведенияОГражданстве.Гражд);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодОКСМ_", СведенияОГражданстве.ОКСМ);
		КонецЕсли;
		
		КодВидаДокумента= КонтролируемыеСделки.ПолучитьКодВидаДокументаПоВидуДокумента(СведенияОФизическомЛице.ВидДокумента);
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодВидаДокумента_", КодВидаДокумента);
		
		Если ЗначениеЗаполнено(СведенияОФизическомЛице.ДокументСерия) Или ЗначениеЗаполнено(СведенияОФизическомЛице.ДокументНомер) Тогда 
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "СерияНомер_",
				СведенияОФизическомЛице.ДокументСерия + " " + СведенияОФизическомЛице.ДокументНомер);
		КонецЕсли;
		
		ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ОрганВыдавшийДокумент_", СведенияОФизическомЛице.ДокументКемВыдан);
		ДобавитьДатуВСтруктуруПараметров(ДанныеЗаполнения, "ДатаВыдачи_", СведенияОФизическомЛице.ДокументДатаВыдачи);
		
		Если СведенияОбУведомлении.ВерсияУведомления < КонтролируемыеСделкиКлиентСервер.ВерсияУведомления_2018() Тогда
			
			Если СведенияОФизическомЛице.ГражданствоФизЛицСтрана = Справочники.СтраныМира.Россия Тогда
				ДанныеЗаполнения.Вставить("МестоЖительства", "1");
			Иначе
				ДанныеЗаполнения.Вставить("МестоЖительства", "2");
			КонецЕсли;
			
			ЗначениеАдреса = ?(ЗначениеЗаполнено(СведенияОФизическомЛице.КонтактнаяИнформацияЗначениеJSON),
				СведенияОФизическомЛице.КонтактнаяИнформацияЗначениеJSON,
				СведенияОФизическомЛице.КонтактнаяИнформацияЗначенияПолей);
			
			АдресСтруктурой = УправлениеКонтактнойИнформациейБП.СтруктураАдреса(ЗначениеАдреса);
			
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Индекс_", АдресСтруктурой.Индекс);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "РегионКод_", АдресСтруктурой.КодРегиона);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Район_", АдресСтруктурой.Район);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Город_", АдресСтруктурой.Город);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "НаселенныйПункт_", АдресСтруктурой.НаселенныйПункт);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Улица_", АдресСтруктурой.Улица);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Дом_", АдресСтруктурой.Дом);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Корпус_", АдресСтруктурой.Корпус);
			ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "Квартира_", АдресСтруктурой.Квартира);
			
		КонецЕсли;
		
		Если СведенияОФизическомЛице.ГражданствоФизЛицСтрана <> Справочники.СтраныМира.Россия Тогда
			НаименованиеСтраны = СведенияОФизическомЛице.КонтактнаяИнформацияЗаРФСтрана;
			Если ЗначениеЗаполнено(НаименованиеСтраны) Тогда
				НайденнаяСтрана = Справочники.СтраныМира.НайтиПоНаименованию(НаименованиеСтраны);
				Если ЗначениеЗаполнено(НайденнаяСтрана) И НайденнаяСтрана <> Справочники.СтраныМира.Россия Тогда
					ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодСтраныОКСМ_", НайденнаяСтрана.Код);
					ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "АдресЗаПределамиРФ_", СведенияОФизическомЛице.КонтактнаяИнформацияЗаРФПредставление);
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Функция ДанныеЗаполненияРаздела4(СведенияОбУведомлении, ДанныеРаздела4)
	
	ДанныеЗаполнения = Новый Структура;
	
	ДобавитьДанныеЗаголовка(ДанныеЗаполнения, СведенияОбУведомлении);
	
	ДобавитьЧислоВСтруктуруПараметров(ДанныеЗаполнения, "ПорядковыйНомерУчастника_", ДанныеРаздела4.НомерКонтрагента, 4, 0);
	
	ДанныеЗаполнения.Вставить("ТипОрганизации", ДанныеРаздела4.ТипОрганизации);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "КодСтраны_", ДанныеРаздела4.КодСтраныРегистрации);
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "ДанныеУчастника_", ДанныеРаздела4.НаименованиеКонтрагента);
	
	ДобавитьСтрокуВСтруктуруПараметров(ДанныеЗаполнения, "РегистрационныйНомер_Контрагента_", ДанныеРаздела4.РегистрационныйНомер);
	
	Возврат ДанныеЗаполнения;
	
КонецФункции

Процедура ДобавитьДанныеЗаголовка(СтруктураПараметров, СведенияОбУведомлении)
	
	ДобавитьВСтруктуруПараметров(СтруктураПараметров, "ИНН", СведенияОбУведомлении.ИНН);
	ДобавитьВСтруктуруПараметров(СтруктураПараметров, "КПП", СведенияОбУведомлении.КПП);
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункцииДляЗаполненияМакетов

Процедура УстановитьНомерСтраницы(Макет, НомерСтраницы, ДлинаНомераСтраницы)
	
	ЧастиНомераСтраницы = Новый Структура();
	ДобавитьЧислоВСтруктуруПараметров(ЧастиНомераСтраницы, "СчетчикСтраниц_", НомерСтраницы, ДлинаНомераСтраницы, 0, Истина);
	ЗаполнитьЗначенияСвойств(Макет.Параметры, ЧастиНомераСтраницы);
	
КонецПроцедуры

Процедура ДобавитьЧислоВСтруктуруПараметров(СтруктураПараметров, ИмяПараметра, ЗначениеПараметра, ДлинаЦелойЧасти, ДлинаДробнойЧасти, ВыводитьЛидирующиеНули = Ложь)
	
	ФорматЧисла = СтрШаблон("ЧЦ=%1; ЧДЦ=%2; ЧРД=.; ЧН=0; %3 ЧГ=0",
		Формат(ДлинаЦелойЧасти+ДлинаДробнойЧасти, ""),
		Формат(ДлинаДробнойЧасти, ""),
		?(ВыводитьЛидирующиеНули, "ЧВН=;", ""));
	
	ЧастиЧисла = СтрРазделить(Формат(ЗначениеПараметра, ФорматЧисла), ".");
	Если ЧастиЧисла.Количество() > 0 Тогда
		ЦелаяЧастьЧисла = ЧастиЧисла[0];
	Иначе
		ЦелаяЧастьЧисла = "";
	КонецЕсли;
	
	ЧислоСтрокой = СтроковыеФункцииКлиентСервер.ДополнитьСтроку(ЦелаяЧастьЧисла, ДлинаЦелойЧасти, " ", "Справа");
	
	Если ЧастиЧисла.Количество() > 1 Тогда
		ДробнаяЧастьЧисла = СтроковыеФункцииКлиентСервер.УдалитьПовторяющиесяСимволы(ЧастиЧисла[1], "0", "Справа");
	Иначе
		ДробнаяЧастьЧисла = "";
	КонецЕсли;
	
	ЧислоСтрокой = ЧислоСтрокой + ДробнаяЧастьЧисла;
	
	ДобавитьВСтруктуруПараметров(СтруктураПараметров, ИмяПараметра, ЧислоСтрокой);
	
КонецПроцедуры

Процедура ДобавитьСтрокуВСтруктуруПараметров(СтруктураПараметров, ИмяПараметра, ЗначениеПараметра, ДлинаСтроки = 0, ДлинаПодстроки = 0)
	
	СтрокаДляВывода = ЗначениеПараметра;
	Если ДлинаСтроки > 0 И ДлинаПодстроки > 0 Тогда
		// Есть дополнительные ограничения по длине строки и делению ее на подстроки.
		// Выводим строку так, что бы целое слово умещалось на строке целиком.
		// Если так не получится - выводим как есть посимвольно.
		Слова = СтрРазделить(ЗначениеПараметра, " ", Ложь);
		
		СтрокаСловВыведенныхПострочно = СловаПострочно(Слова, ДлинаСтроки, ДлинаПодстроки);
		Если ЗначениеЗаполнено(СтрокаСловВыведенныхПострочно) Тогда
			СтрокаДляВывода = СтрокаСловВыведенныхПострочно;
		КонецЕсли;
		
	КонецЕсли;
	
	СтрокаДляВывода = ВРег(СтрокаДляВывода);
	
	ДобавитьВСтруктуруПараметров(СтруктураПараметров, ИмяПараметра, СтрокаДляВывода);
	
КонецПроцедуры

Функция СловаПострочно(Слова, ДлинаСтроки, ДлинаПодстроки)
	
	СтрокаСлов = "";
	ВсеСловаВыведены = Ложь;
	
	Для Каждого Слово Из Слова Цикл
		
		Если СтрокаСлов = "" Тогда
			СтрокаСлов = Слово;
		ИначеЕсли СтрДлина(Слово) > ДлинаПодстроки Тогда
			// Слово слишком длинное - выводим его как есть.
			СтрокаСлов = СтрокаСлов + " " + Слово;
		Иначе
			СимволовВСтроке = СтрДлина(СтрокаСлов);
			ВсегоПолныхСтрок = Цел(СимволовВСтроке/ДлинаПодстроки);
			СимволовВПолныхСтроках = ВсегоПолныхСтрок * ДлинаПодстроки;
			СимволовВПоследнейПодстроке = СимволовВСтроке - СимволовВПолныхСтроках;
			Если СимволовВПоследнейПодстроке + 1 + СтрДлина(Слово) > ДлинаПодстроки Тогда
				СтрокаСлов = СтроковыеФункцииКлиентСервер.ДополнитьСтроку(СтрокаСлов, ДлинаПодстроки, " ", "Справа");
				СтрокаСлов = СтрокаСлов + Слово;
			Иначе
				СтрокаСлов = СтрокаСлов + ?(СимволовВПоследнейПодстроке = 0, "", " ") + Слово;
			КонецЕсли;
		КонецЕсли;
		
	КонецЦикла;
	
	Если СтрДлина(СтрокаСлов) > ДлинаСтроки Тогда
		// Слова, выведенные построчно занимают места больше,
		// чем можно вывести. Поэтому считаем, что вывод не
		// удался и возвращаем пустую строку.
		Возврат "";
	Иначе
		Возврат СтрокаСлов;
	КонецЕсли;
	
КонецФункции

Процедура ДобавитьДатуВСтруктуруПараметров(СтруктураПараметров, ИмяПараметра, ЗначениеПараметра)
	
	ДатаСтрокой = Формат(ЗначениеПараметра, "ДФ=ddMMyyyy");
	ДобавитьВСтруктуруПараметров(СтруктураПараметров, ИмяПараметра, ДатаСтрокой);
	
КонецПроцедуры

Процедура ДобавитьВСтруктуруПараметров(СтруктураПараметров, ИмяПараметра, ЗначениеПараметра)
	
	Для Позиция = 1 По СтрДлина(ЗначениеПараметра) Цикл
		ИмяПараметраЧастиЧисла = ИмяПараметра + Формат(Позиция, "ЧГ=0");
		СтруктураПараметров.Вставить(ИмяПараметраЧастиЧисла, Сред(ЗначениеПараметра, Позиция, 1));
	КонецЦикла;
	
КонецПроцедуры

Процедура УстановитьПараметрыПечатиУведомления(ЛистыУведомления) Экспорт
	
	ЛистыУведомления.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
	ЛистыУведомления.АвтоМасштаб = Истина;
	ЛистыУведомления.ПолеСверху          = 5;
	ЛистыУведомления.ПолеСнизу           = 5;
	ЛистыУведомления.КлючПараметровПечати = "Документ.УведомлениеОКонтролируемыхСделках";
	
КонецПроцедуры

Функция РазложитьОКПД2ВСтроку(ИсходныйКодСТочками)
	
	МассивКодов = СтрРазделить(ИсходныйКодСТочками, ".");
	
	Для НомерКода = 0 По МассивКодов.Количество() - 1 Цикл
		
		ДлинаЧастиКода = ?(НомерКода < 3, 2, 3);
		МассивКодов[НомерКода] = СтроковыеФункцииКлиентСервер.ДополнитьСтроку(МассивКодов[НомерКода],
			ДлинаЧастиКода, " ", "Справа");
		
	КонецЦикла;
	
	Возврат СтрСоединить(МассивКодов, "");
	
КонецФункции

Функция КодПоОКПИзКодаПоОКПД2(КодПоОКПД2) Экспорт
	
	Если НЕ ЗначениеЗаполнено(КодПоОКПД2) Тогда
		Возврат "";
	КонецЕсли;
	
	КодПоОКП = СтрЗаменить(КодПоОКПД2, ".", "");
	КодПоОКП = Лев(СтроковыеФункцииКлиентСервер.ДополнитьСтроку(КодПоОКП, 6, "0", "Справа"), 6);
	Возврат КодПоОКП;
	
КонецФункции

Функция РазложитьОКВЭДВСтроку(ИсходныйКодСТочками)
	
	МассивКодов = СтрРазделить(ИсходныйКодСТочками, ".");
	
	Для НомерКода = 0 По МассивКодов.Количество() - 1 Цикл
		МассивКодов[НомерКода] = СтроковыеФункцииКлиентСервер.ДополнитьСтроку(МассивКодов[НомерКода],
			2, " ", "Справа");
	КонецЦикла;
	
	Возврат СтрСоединить(МассивКодов, "");
	
КонецФункции

#КонецОбласти

#Область ДанныеКлассификаторов

Функция ПолучитьСписокКодовНаименованийСделки() Экспорт
	
	Возврат ПолучитьСписокИзМакета("КонтролируемыеСделкиСпискиКодов", "ТипИСтороныДоговора");
	
КонецФункции

Функция ПолучитьСоответствиеКодовСтороныСделки() Экспорт
	
	СоответствиеКодов = Новый Соответствие();
	
	Макет = ПолучитьОбщийМакет("КонтролируемыеСделкиСпискиКодов");
	ОбластьМакета = Макет.ПолучитьОбласть("ТипИСтороныДоговора");
	
	Для Ном = 1 По ОбластьМакета.ВысотаТаблицы Цикл
		КодНаименованияСделки = ОбластьМакета.Область(Ном,1, Ном, 1).Текст;
		СписокКодов = Новый СписокЗначений();
		Для к = 2 по 4 Цикл
			Код = ОбластьМакета.Область(Ном, к*2 - 1 , Ном, к*2 - 1).Текст;
			Наименование = ОбластьМакета.Область(Ном, к*2, Ном, к*2).Текст;
			Если ЗначениеЗаполнено(Код) Тогда
				СписокКодов.Добавить(Код, "" + Код + " - " + Наименование);
			КонецЕсли;
		КонецЦикла;
		СоответствиеКодов.Вставить(КодНаименованияСделки, СписокКодов);
	КонецЦикла;
	
	Возврат СоответствиеКодов;
	
КонецФункции

Функция ПолучитьКодыУсловийПоставки() Экспорт
	
	Возврат ПолучитьСписокИзМакета("КонтролируемыеСделкиСпискиКодов", "КодУсловийПоставки");
	
КонецФункции

Функция ПолучитьКодыВидовДеятельностиФизЛиц() Экспорт
	
	СписокКодов = Новый СписокЗначений();
	
	Макет = ПолучитьОбщийМакет("КонтролируемыеСделкиСпискиКодов");
	ОбластьМакета = Макет.ПолучитьОбласть("КодВидаДеятельности");

	Для Ном = 1 По ОбластьМакета.ВысотаТаблицы Цикл
		ТекКод = ОбластьМакета.Область(Ном, 1, Ном, 1).Текст;
		ТекНаименование = ОбластьМакета.Область(Ном, 2, Ном, 2).Текст;
		СписокКодов.Добавить(ТекКод, "" + ТекКод + " - " + ТекНаименование);
	КонецЦикла;
	
	Возврат СписокКодов;
	
КонецФункции

Функция ПолучитьКодыОпределенияЦеныСделки() Экспорт
	
	Возврат ПолучитьСписокИзМакета("КонтролируемыеСделкиСпискиКодов", "ОснованияПризнанияЦеныСделкиРыночной");
	
КонецФункции

Функция ПолучитьКодыМетодовЦенообразования() Экспорт
	
	Возврат ПолучитьСписокИзМакета("КонтролируемыеСделкиСпискиКодов", "МетодыЦенообразования");
	
КонецФункции

Функция ПолучитьКодыКатегорийНалогоплательщика() Экспорт
	
	Возврат ПолучитьСписокИзМакета("КонтролируемыеСделкиСпискиКодов", "КодКатегорииНалогоплательщика");
	
КонецФункции

Функция ПолучитьКодыФормыРеорганизации() Экспорт
	
	Возврат ПолучитьСписокИзМакета("КонтролируемыеСделкиСпискиКодов", "КодРеорганизации");
	
КонецФункции

Функция ПолучитьСписокИзМакета(ИмяМакета, ИмяОбласти)
	
	СписокКодов = Новый СписокЗначений();
	
	Макет = ПолучитьОбщийМакет(ИмяМакета);
	ОбластьМакета = Макет.ПолучитьОбласть(ИмяОбласти);
	
	Для Ном = 1 По ОбластьМакета.ВысотаТаблицы Цикл
		ТекКод = ОбластьМакета.Область(Ном,1, Ном, 1).Текст;
		ТекНаименование = ОбластьМакета.Область(Ном, 2, Ном, 2).Текст;
		Если ЗначениеЗаполнено(ТекКод) Тогда
			ТекНаименование = "" + ТекКод + " - " + ТекНаименование;
		КонецЕсли;
		СписокКодов.Добавить(ТекКод, ТекНаименование);
	КонецЦикла;
	
	Возврат СписокКодов;
	
КонецФункции

#КонецОбласти

