#Область СлужебныйПрограммныйИнтерфейс

#Область ОбработчикиСобытийФормы

// Возникает на сервере при создании формы.
//
// Параметры:
//  Форма - ФормаКлиентскогоПриложения - создаваемая форма,
//  Отказ - Булево - признак отказа от создания формы,
//  СтандартнаяОбработка - Булево - признак выполнения стандартной обработки.
Процедура ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
	ИмяФормы = Форма.ИмяФормы;
	
	Если ИмяФормы = "Документ.ВозвратИзРегистра2ЕГАИС.Форма.ФормаСпискаДокументов" Тогда
		Форма.Элементы.СтраницаКОформлению.Видимость = Ложь;
		Форма.Элементы.Страницы.ОтображениеСтраниц = ОтображениеСтраницФормы.Нет;
	КонецЕсли;
	
	Если ИмяФормы = "Обработка.ПроверкаИПодборПродукцииИСМП.Форма.ИнформацияОНевозможностиДобавленияОтсканированного" Тогда
		МожноОткрытьФормуПроверкиПодбора = (Форма.Параметры.ИмяФормыИсточник = "Документ.РеализацияТоваровУслуг.Форма.ФормаДокументаТовары");
		Для каждого ЭлементФормы Из Форма.Элементы Цикл
			Если СтрНачинаетсяС(ЭлементФормы.Имя, "ОткрытьФормуПроверкиИПодбора_") 
				И ЭлементФормы.Вид = ВидКнопкиФормы.КнопкаКоманднойПанели Тогда
				
				ЭлементФормы.Видимость = МожноОткрытьФормуПроверкиПодбора;
			КонецЕсли; 
		КонецЦикла; 
	ИначеЕсли ИмяФормы = "Обработка.ПроверкаИПодборПродукцииИСМП.Форма.ПроверкаИПодбор" Тогда
		ИнтеграцияИСМПБП.ПодготовитьФормуПроверкаИПодбор(Форма);
	ИначеЕсли ИмяФормы = "Обработка.ПанельОбменЗЕРНО.Форма.Форма"
		Или ИмяФормы = "Справочник.НастройкиРегламентныхЗаданийЗЕРНО.Форма.ФормаНастроек" Тогда
		ОбщегоНазначенияИСКлиентСервер.НастроитьОтборПоОрганизации(Форма, Форма.Организации, Неопределено, "Отбор");
	КонецЕсли; 
	
	ЭлементСерия = Форма.Элементы.Найти("Серия");
	Если ЭлементСерия <> Неопределено Тогда
		ЭлементСерия.Видимость = Ложь;
	КонецЕсли; 
	
	ЭлементХарактеристика = Форма.Элементы.Найти("Характеристика");
	Если ЭлементХарактеристика <> Неопределено Тогда
		ЭлементХарактеристика.Видимость = Ложь;
	КонецЕсли; 
	
	Если ИнтеграцияЕГАИСБП.СписокФормДляДобавленияБаннера().Найти(Форма.ИмяФормы) <> Неопределено Тогда
		ИнтеграцияЕГАИСБП.ДобавитьБаннерНаФорму(Форма);
	КонецЕсли;
	
	КнопкаПодбор = Форма.Элементы.Найти("ТоварыОткрытьПодбор");
	Если КнопкаПодбор = Неопределено Тогда
		КнопкаПодбор = Форма.Элементы.Найти("ТоварыОткрытьПодборНомеклатуры");
	КонецЕсли;
	
	Если КнопкаПодбор <> Неопределено Тогда
		КнопкаПодбор.Видимость = Ложь;
	КонецЕсли;
	
	Если ИмяФормы = "РегистрСведений.ПулКодовМаркировкиСУЗ.Форма.ФормаПечати" Тогда
		ИнтеграцияИСМПБП.ПодготовитьФормуПечатьЭтикетокИСМП(Форма);
	КонецЕсли;
	
	СобытияФормЗЕРНОБПВызовСервера.СкрытьХарактеристикуИСериюВДокументахЗЕРНО(Форма);
	
	Если Найти(ИмяФормы,"Классификатор")>0 И Найти(ИмяФормы,"ЗЕРНО")>0 Тогда
		КнопкаСкопировать = Форма.Элементы.Найти("ФормаСкопировать");
		Если КнопкаСкопировать <> Неопределено Тогда
			Форма.Элементы.ФормаСкопировать.Видимость = Ложь;	
		КонецЕсли;
	КонецЕсли;
	
	Если ИмяФормы = "Документ.ОтчетОПроизводствеЕГАИС.Форма.ФормаДокумента" 
		ИЛИ ИмяФормы = "Документ.УведомлениеОПланируемомИмпортеЕГАИС" 
		ИЛИ ИмяФормы = "Документ.ОтчетОбИмпортеЕГАИС" Тогда
		ЭлементХарактеристика = Форма.Элементы.Найти("ТоварыХарактеристика");
		Если ЭлементХарактеристика <> Неопределено Тогда
			Форма.Элементы.ТоварыХарактеристика.Видимость = Ложь;	
		КонецЕсли;
		ЭлементХарактеристика = Форма.Элементы.Найти("СырьеХарактеристика");
		Если ЭлементХарактеристика <> Неопределено Тогда
			Форма.Элементы.СырьеХарактеристика.Видимость = Ложь;	
		КонецЕсли;
		ЭлементСерия = Форма.Элементы.Найти("ТоварыСерия");
		Если ЭлементСерия <> Неопределено Тогда
			Форма.Элементы.ТоварыСерия.Видимость = Ложь;
		КонецЕсли;
		ЭлементСерия = Форма.Элементы.Найти("СырьеСерия");
		Если ЭлементСерия <> Неопределено Тогда
			Форма.Элементы.СырьеСерия.Видимость = Ложь;
		КонецЕсли;
	КонецЕсли;
	
	Если Не ПолучитьФункциональнуюОпцию("ИспользоватьНесколькоОрганизаций") Тогда
		
		Если ИмяФормы = "Документ.ВозвратВОборотИСМП.Форма.ФормаСпискаДокументов"
			ИЛИ ИмяФормы = "Документ.ВыводИзОборотаИСМП.Форма.ФормаСпискаДокументов"
			ИЛИ ИмяФормы = "Документ.ЗаказНаЭмиссиюКодовМаркировкиСУЗ.Форма.ФормаСпискаДокументов"
			ИЛИ ИмяФормы = "Документ.МаркировкаТоваровИСМП.Форма.ФормаСпискаДокументов"
			ИЛИ ИмяФормы = "Документ.ПеремаркировкаТоваровИСМП.Форма.ФормаСпискаДокументов"
			ИЛИ ИмяФормы = "Документ.ОтгрузкаТоваровИСМП.Форма.ФормаСпискаДокументов"
			ИЛИ ИмяФормы = "Документ.СписаниеКодовМаркировкиИСМП.Форма.ФормаСпискаДокументов" Тогда

			Форма.Элементы.СтраницыОформленоОтборОрганизация.Видимость = Ложь;
			Форма.Элементы.СтраницыКОформлениюОтборОрганизация.Видимость = Ложь;
			Форма.Элементы.СписокКОформлениюОрганизация.Видимость = Ложь;
			Форма.Элементы.Организация.Видимость = Ложь;
			Форма.Элементы.СписокКОформлениюОрганизация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Документ.ПриемкаТоваровИСМП.Форма.ФормаСпискаДокументов" Тогда
			
			Форма.Элементы.СтраницыОформленоОтборОрганизация.Видимость = Ложь;
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Обработка.ПанельОбменИСМП.Форма.Форма" Тогда
			
			Форма.Элементы.СтраницыОтборОрганизация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Документ.ВозвратВОборотИСМП.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.ВыводИзОборотаИСМП.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.ЗаказНаЭмиссиюКодовМаркировкиСУЗ.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.МаркировкаТоваровИСМП.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.ПеремаркировкаТоваровИСМП.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.ОтгрузкаТоваровИСМП.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.ПриемкаТоваровИСМП.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.СписаниеКодовМаркировкиИСМП.Форма.ФормаСписка" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Документ.ВозвратВОборотИСМП.Форма.ФормаДокумента"
			ИЛИ ИмяФормы = "Документ.ВыводИзОборотаИСМП.Форма.ФормаДокумента"
			ИЛИ ИмяФормы = "Документ.ЗаказНаЭмиссиюКодовМаркировкиСУЗ.Форма.ФормаДокумента"
			ИЛИ ИмяФормы = "Документ.МаркировкаТоваровИСМП.Форма.ФормаДокумента"
			ИЛИ ИмяФормы = "Документ.ПеремаркировкаТоваровИСМП.Форма.ФормаДокумента"
			ИЛИ ИмяФормы = "Документ.ОтгрузкаТоваровИСМП.Форма.ФормаДокумента"
			ИЛИ ИмяФормы = "Документ.ПриемкаТоваровИСМП.Форма.ФормаДокумента"
			ИЛИ ИмяФормы = "Документ.СписаниеКодовМаркировкиИСМП.Форма.ФормаДокумента" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
		ИначеЕсли ИмяФормы = "Документ.ПриемкаТоваровИСМП.Форма.ЗагрузкаВходящихДокументов" И Форма.Организации.Количество() Тогда
			Форма.Элементы.Организация.Видимость = Ложь;
		ИначеЕсли ИмяФормы = "Справочник.ШаблоныЭтикетокСУЗ.Форма.ФормаСписка" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Справочник.ШаблоныЭтикетокСУЗ.Форма.ФормаЭлемента" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "ОтчетИСМП.Форма.ФормаДокумента" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "ОтчетИСМП.Форма.ФормаСписка" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "ОтчетИСМП.Форма.ФормаСпискаДокументов" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
			
		//ЗЕРНО
		ИначеЕсли ИмяФормы = "Документ.ФормированиеПартийЗЕРНО.Форма.ФормаСпискаДокументов"
			ИЛИ ИмяФормы = "Документ.ФормированиеПартийИзДругихПартийЗЕРНО.Форма.ФормаСпискаДокументов" Тогда
			
			Форма.Элементы.СтраницыОформленоОтборОрганизация.Видимость = Ложь;
			Форма.Элементы.СтраницыКОформлениюОтборОрганизация.Видимость = Ложь;
			Форма.Элементы.СписокКОформлениюОрганизация.Видимость = Ложь;
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Документ.ФормированиеПартийЗЕРНО.Форма.ФормаСписка"
			ИЛИ ИмяФормы = "Документ.ФормированиеПартийИзДругихПартийЗЕРНО.Форма.ФормаСписка" Тогда
			
			Форма.Элементы.Организация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Справочник.РеестрПартийЗЕРНО.Форма.ФормаСписка" Тогда
			
			Форма.Элементы.СтраницыОтборОрганизация.Видимость = Ложь;
			
		ИначеЕсли ИмяФормы = "Документ.ФормированиеПартийЗЕРНО.Форма.ФормаДокумента" Тогда
			
			Форма.Элементы.Организация.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьНесколькоОрганизацийБухгалтерскийУчет");
			
		ИначеЕсли ИмяФормы = "Обработка.ПанельОбменЗЕРНО.Форма.Форма" Тогда
			
			Форма.Элементы.СтраницыОтборОрганизация.Видимость = Ложь;
		//Конец ЗЕРНО
		ИначеЕсли ИмяФормы = "РегистрСведений.НастройкиПодключенияТСПИоТ.ФормаСписка"
			ИЛИ ИмяФормы = "РегистрСведений.НастройкиПодключенияТСПИоТ.ФормаЗаписи" Тогда
            Форма.Элементы.Организация.Видимость = Ложь;
		КонецЕсли;	
	КонецЕсли;
	
	Если ИмяФормы = "Документ.МаркировкаТоваровИСМП.Форма.ФормаДокумента"
		Или ИмяФормы = "Документ.ОтгрузкаТоваровИСМП.Форма.ФормаДокумента"
		Или ИмяФормы = "Документ.ВыводИзОборотаИСМП.Форма.ФормаДокумента" Тогда
			Форма.Элементы.ТоварыСтавкаНДС.ОграничениеТипа = Новый ОписаниеТипов("ПеречислениеСсылка.СтавкиНДС");
	КонецЕсли;
	
	ДополнительныеПараметры = Неопределено;
	СобытияФормИС.ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка, ДополнительныеПараметры);
	ШтрихкодированиеИС.ИнициализироватьКэшМаркируемойПродукции(Форма);
	
	Если ИмяФормы = "Обработка.ПанельАдминистрированияВЕТИС.Форма.НастройкиВЕТИС" Тогда
		ОписаниеРеквизита 						= Новый Структура("ИмяРеквизита,ЗаголовокРеквизита,ТипРеквизита");
		ОписаниеРеквизита.ИмяРеквизита 			= "ИспользоватьРаздельноеСписаниеМатериаловИВыпускПродукцииВЕТИС";
		ОписаниеРеквизита.ЗаголовокРеквизита 	= "Использовать производственные транзакции";
		ОписаниеРеквизита.ТипРеквизита 			= Новый ОписаниеТипов("Булево");
		СобытияФормВЕТИСБПВызовСервера.ДобавитьРеквизитФормы(Форма, ОписаниеРеквизита);
		
		СобытияФормВЕТИСБПВызовСервера.ОбновитьЗначениеРеквизитаФормы(Форма,"ИспользоватьРаздельноеСписаниеМатериаловИВыпускПродукцииВЕТИС");
		
		ОписаниеЭлемента 						= Новый Структура("ИмяЭлемента,ЗаголовокЭлемента,ПоложениеЗаголовка,ВидЭлемента,ПутьКДанным,РодительскаяГруппа,РасширеннаяПодсказка,ТекстПодсказки");
		ОписаниеЭлемента.ИмяЭлемента			= "ИспользоватьРаздельноеСписаниеМатериаловИВыпускПродукцииВЕТИС";
		ОписаниеЭлемента.ЗаголовокЭлемента		= "Использовать производственные транзакции";
		ОписаниеЭлемента.ПоложениеЗаголовка		= ПоложениеЗаголовкаЭлементаФормы.Право;
		ОписаниеЭлемента.ВидЭлемента			= ВидПоляФормы.ПолеФлажка;
		ОписаниеЭлемента.ПутьКДанным			= "ИспользоватьРаздельноеСписаниеМатериаловИВыпускПродукцииВЕТИС";
		ОписаниеЭлемента.РодительскаяГруппа 	= "ГруппаНастройкиПраваяПанель";
		ОписаниеЭлемента.РасширеннаяПодсказка 	= Истина;
		ОписаниеЭлемента.ТекстПодсказки        	= "Позволяет связать списание материалов в производство документом ""Расход материалов"" с выпуском продукции в ВЕТИС";
		Действие = Новый Структура("ИмяСобытия,ИмяОбработчика","ПриИзменении","Подключаемый_ПриИзмененииРеквизита");
		СобытияФормВЕТИСБПВызовСервера.ДобавитьЭлементУправления(Форма, ОписаниеЭлемента, Действие);
		
		СобытияФормВЕТИСБПВызовСервера.УстановитьВидимостьДополнительногоЭлемента(Форма,"ИспользоватьРаздельноеСписаниеМатериаловИВыпускПродукцииВЕТИС");
		
	КонецЕсли;
	
	Если ИмяФормы = "Документ.ПроизводственнаяОперацияВЕТИС.Форма.ФормаДокумента" Тогда
		Если ПолучитьФункциональнуюОпцию("ИспользоватьРаздельноеСписаниеМатериаловИВыпускПродукцииВЕТИС") Тогда
			СобытияФормВЕТИСБПВызовСервера.НастроитьЭлементыПроизводственнойТранзакцииНаФорме(Форма);
		КонецЕсли;
	КонецЕсли;
	
	Если ИмяФормы = "Документ.ПроизводственнаяОперацияВЕТИС.Форма.ФормаСпискаДокументов" Тогда
		Если ПолучитьФункциональнуюОпцию("ИспользоватьРаздельноеСписаниеМатериаловИВыпускПродукцииВЕТИС") Тогда
			Форма["Список"].ТекстЗапроса = ИнтеграцияВЕТИСБПВызовСервера.ПолучитьТекстЗапросаСписка();
			
			ИнтеграцияВЕТИСБПВызовСервера.ДобавитьКолонкуВДинамическийСписокФормы(Форма,"Список","ПроизводственнаяТранзакция","Производственная транзакция");
			ИнтеграцияВЕТИСБПВызовСервера.ДобавитьКолонкуВДинамическийСписокФормы(Форма,"Список","СостояниеТранзакции","Состояние транзакции");
			
			ЭлементОтбора 					= Форма["Список"].Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
			ЭлементОтбора.ЛевоеЗначение 	= Новый ПолеКомпоновкиДанных("СтатусВЕТИС");
			ЭлементОтбора.ВидСравнения 		= ВидСравненияКомпоновкиДанных.НеРавно;
			ЭлементОтбора.Использование 	= Истина;
			ЭлементОтбора.РежимОтображения 	= РежимОтображенияЭлементаНастройкиКомпоновкиДанных.Недоступный;
			ЭлементОтбора.ПравоеЗначение 	= Перечисления.СтатусыОформленияДокументовГосИС.Оформлено;
		КонецЕсли;
	КонецЕсли;
	
	Если ИмяФормы = "Обработка.ПанельАдминистрированияИСМП.Форма.НастройкиИСМП" Тогда
		
		МаркировкаПростойИнтерфейс.ПанельАдминистрированияИСМП_ПриСозданииНаСервере(Форма);
		
	КонецЕсли;
	
	Если ИмяФормы = "Обработка.ПанельОбменИСМП.Форма.Форма" Тогда
		
		МаркировкаПростойИнтерфейс.ПанельОбменаИСМП_ПриСозданииНаСервере(Форма);
		
	КонецЕсли;
	
	Если ИмяФормы = "Документ.ПеремещениеМеждуМОДИСМП.Форма.ФормаСпискаДокументов"
		Или ИмяФормы = "Документ.РазрешениеНаОтгрузкуИСМП.Форма.ФормаСпискаДокументов" Тогда
		Если Не ПолучитьФункциональнуюОпцию("ИспользоватьНесколькоОрганизаций") Тогда
			ЭлементОрганизация = Форма.Элементы.Найти("Организация");
			Если Не ЭлементОрганизация  = Неопределено Тогда
				Если Не ПолучитьФункциональнуюОпцию("ИспользоватьНесколькоОрганизаций") Тогда
					Форма.Организация = БухгалтерскийУчетПереопределяемый.ПолучитьЗначениеПоУмолчанию("ОсновнаяОрганизация");
					Форма.Элементы.Организация.Видимость = Ложь;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		ЭлементХарактеристика = Форма.Элементы.Найти("ТоварыХарактеристика");
		Если Не ЭлементХарактеристика = Неопределено Тогда
			ЭлементХарактеристика.Видимость = Ложь;
		КонецЕсли;
		ЭлементСерия = Форма.Элементы.Найти("ТоварыСерия");
		Если Не ЭлементСерия = Неопределено Тогда
			ЭлементСерия.Видимость = Ложь;
		КонецЕсли;
	КонецЕсли;
	
	//САТУРН
	Если ИмяФормы = "РегистрСведений.НастройкиПодключенияСАТУРН.ФормаСписка" Тогда
		Форма.Элементы.Организация.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьНесколькоОрганизацийБухгалтерскийУчет");
	ИначеЕсли ИмяФормы = "РегистрСведений.НастройкиПодключенияСАТУРН.Форма.ФормаЗаписи" Тогда
		Форма.Элементы.Организация.Видимость = ПолучитьФункциональнуюОпцию("ИспользоватьНесколькоОрганизацийБухгалтерскийУчет");	
		Если Не ЗначениеЗаполнено(Форма.Запись.Организация) Тогда
			Форма.Запись.Организация = Справочники.Организации.ОрганизацияПоУмолчанию();
		КонецЕсли;
	КонецЕсли;
	//САТУРН
	
КонецПроцедуры

// Вызывается при чтении объекта на сервере.
//
// Параметры:
//  Форма - ФормаКлиентскогоПриложения - форма читаемого объекта,
//  ТекущийОбъект - ДокументОбъект, СправочникОбъект - читаемый объект.
Процедура ПриЧтенииНаСервере(Форма, ТекущийОбъект) Экспорт
	
	СобытияФормИС.ПриЧтенииНаСервере(Форма, ТекущийОбъект);
	
КонецПроцедуры

// Переопределяемая процедура, вызываемая из одноименного обработчика события формы.
//
// Параметры:
//  Форма - ФормаКлиентскогоПриложения - форма, из обработчика события которой происходит вызов процедуры.
//          См. справочную информацию по событиям управляемой формы.
//  ТекущийОбъект - Произвольный - записанный объект.
//  ПараметрыЗаписи - Структура - использованные параметры записи объекта.
Процедура ПослеЗаписиНаСервере(Форма, ТекущийОбъект, ПараметрыЗаписи)Экспорт
	
	Возврат;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
