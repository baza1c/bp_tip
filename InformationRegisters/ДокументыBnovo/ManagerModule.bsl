#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

// ДокументыПоНомеруБрони - возвращает документы загруженные по номеру брони
//
// Параметры:
//  Организация  - <СправочникСсылка.Организации>
//  Гостиница  - <СправочникСсылка.Гостиницы> 
//  Гостиница  - <Массив> - массив строк с описаниями броней
//
// Возвращаемое значение:
//   <Соотвествие>   - соответсвие номера брони и массива документов по этой брони
//

Функция ДокументыПоНомеруБрони(Организация, Гостиница, СписокБроней) Экспорт
	Результат = Новый Соответствие;
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("Гостиница",   Гостиница);
	Запрос.УстановитьПараметр("СписокБроней", СписокБроней);
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ДокументыBnovo.Документ КАК Документ,
	|	ДокументыBnovo.НомерБрони КАК НомерБрони
	|ИЗ
	|	РегистрСведений.ДокументыBnovo КАК ДокументыBnovo
	|ГДЕ
	|	ДокументыBnovo.НомерБрони = &НомерБрони
	|	И ДокументыBnovo.Организация = &Организация
	|	И ДокументыBnovo.Гостиница = &Гостиница";
	
	Выборка = Запрос.Выполнить().Выбрать();
	Пока Выборка.Следующий() Цикл
		
		Соотвествие_НомерБрони = Результат[Выборка.НомерБрони];
		Если Соотвествие_НомерБрони = Неопределено Тогда
		
			Соотвествие_НомерБрони = Новый Соответствие;
			Результат.Вставить(Соотвествие_НомерБрони, Выборка.НомерБрони);
		КонецЕсли;
		
		ТипЗначения = ТипЗнч(Выборка.Документ);
		Если Соотвествие_НомерБрони[ТипЗначения] = Неопределено Тогда
			Соотвествие_НомерБрони.Вставить(ТипЗначения, Новый Массив);
		КонецЕсли;
		
		Соотвествие_НомерБрони[ТипЗначения].Добавить(Выборка.Документ);
	КонецЦикла;
	
	Возврат Результат;
КонецФункции 
#КонецОбласти

#Область СлужебныйПрограммныйИнтерфейс

// СтандартныеПодсистемы.УправлениеДоступом
// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
//
// Параметры:
//  Ограничение - Структура:
//    * Текст                             - Строка - ограничение доступа для пользователей.
//                                          Если пустая строка, значит, доступ разрешен.
//    * ТекстДляВнешнихПользователей      - Строка - ограничение доступа для внешних пользователей.
//                                          Если пустая строка, значит, доступ запрещен.
//    * ПоВладельцуБезЗаписиКлючейДоступа - Неопределено - определить автоматически.
//                                        - Булево - если Ложь, то всегда записывать ключи доступа,
//                                          если Истина, тогда не записывать ключи доступа,
//                                          а использовать ключи доступа владельца (требуется,
//                                          чтобы ограничение было строго по объекту-владельцу).
//   * ПоВладельцуБезЗаписиКлючейДоступаДляВнешнихПользователей - Неопределено, Булево - также
//                                          как у параметра ПоВладельцуБезЗаписиКлючейДоступа.
//
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт
	
	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ЗначениеРазрешено(Организация)";
	
КонецПроцедуры
// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

#КонецЕсли